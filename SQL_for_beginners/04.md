# 4.  Встроенные функции

## Содержание


+ [4.1 Текстовые функции. Часть 1](#41-текстовые-функции-часть-1)
    + [Функции](#функции)
    + [Функция `CHAR_LENGTH()`](#функция-char_length)
    + [Функция `LOWER()`](#функция-lower)
    + [Функция `UPPER()`](#функция-upper)
    + [Функции `LTRIM()` и `RTRIM()`](#функции-ltrim-и-rtrim)
    + [Функция `REVERSE()`](#функция-reverse)
    + [Функция `REPEAT()`](#функция-repeat)
    + [Функции `LPAD()` и `RPAD()`](#функции-lpad-и-rpad)
    + [Примеры использования функций]()
+ [4.2 Текстовые функции. Часть 2](#42-текстовые-функции-часть-2)
+ [4.3 Текстовые функции. Часть 3](#43-текстовые-функции-часть-3)
+ [4.4 Числовые функции. Часть 1](#44-числовые-функции-часть-1)
+ [4.5 Числовые функции. Часть 2](#45-числовые-функции-часть-2)
+ [4.6 Функции даты и времени. Часть 1](#46-функции-даты-и-времени-часть-1)
+ [4.7 Функции даты и времени. Часть 2](#47-функции-даты-и-времени-часть-2)
+ [4.8 Функции даты и времени. Часть 3](#48-функции-даты-и-времени-часть-3)
+ [4.9 Функции даты и времени. Часть 4](#49-функции-даты-и-времени-часть-4)
+ [4.10 Дополнительные функции](#410-дополнительные-функции)
+ [4.11 Условные конструкции](#411-условные-конструкции)

[Оглавление](/SQL_for_beginners/README.MD)

# 4.1 Текстовые функции. Часть 1

Урок посвящен функциям, предназначенным для обработки текстовых данных.

## Функции

Как и практически любой язык программирования, SQL имеет множество встроенных функций, которые позволяют выполнять различные манипуляции с данными. Все встроенные функции можно разбить на четыре основных типа:
+ **Текстовые функции.** Используются для обработки текста, например, для отсечения пробелов или преобразования символов в верхний регистр.
+ **Числовые функции.** Используются для выполнения математических операций над числовыми данными: например, возведения в степень или извлечения квадратного корня.
+ **Функции даты и времени.** Используются для обработки даты и времени, это может быть определение разницы между датами или проверка даты на корректность.
+ **Системные функции.** Используются для получения специфичной для конкретной СУБД информации, к примеру, сведений об учетной записи пользователя.

Одними из самых важных являются текстовые функции, так как таблицы баз данных зачастую содержат немалое количество текстовой информации. Поэтому знакомство со встроенными функциями мы начнем именно с тех, которые предназначены для обработки строковых значений.

Для более наглядной демонстрации работы рассматриваемых функций мы будем применять их к конкретным значениям, а не к полям какой-либо таблицы.

<hr>

[Содержание](#содержание)

## Функция `CHAR_LENGTH()`
Функция `CHAR_LENGTH()` используется для вычисления длины строки. Она принимает в качестве аргумента строку и возвращает количество символов в ней.

Результатом приведенного ниже запроса:

```sql
SELECT CHAR_LENGTH(''),
       CHAR_LENGTH('b'),
       CHAR_LENGTH('bee'),
       CHAR_LENGTH('beegeek');
```

является:

```
+-----------------+------------------+--------------------+------------------------+
| CHAR_LENGTH('') | CHAR_LENGTH('b') | CHAR_LENGTH('bee') | CHAR_LENGTH('beegeek') |
+-----------------+------------------+--------------------+------------------------+
| 0               | 1                | 3                  | 7                      |
+-----------------+------------------+--------------------+------------------------+
```

<hr>

[Содержание](#содержание)

## Функция `LOWER()`
Функция `LOWER()` используется для перевода строки в нижний регистр. Она принимает в качестве аргумента строку, преобразует все ее символы в нижний регистр и возвращает полученный результат.

Результатом приведенного ниже запроса:

```sql
SELECT LOWER('beegeek'),
       LOWER('BeeGeek'),
       LOWER('BEEGEEK');
```

является:

```
+------------------+------------------+------------------+
| LOWER('beegeek') | LOWER('BeeGeek') | LOWER('BEEGEEK') |
+------------------+------------------+------------------+
| beegeek          | beegeek          | beegeek          |
+------------------+------------------+------------------+
```

<hr>

[Содержание](#содержание)

## Функция `UPPER()`

Функция `UPPER()` используется для перевода строки в верхний регистр. Она принимает в качестве аргумента строку, преобразует все ее символы в верхний регистр и возвращает полученный результат.

Результатом приведенного ниже запроса:

```sql
SELECT UPPER('beegeek'),
       UPPER('BeeGeek'),
       UPPER('BEEGEEK');
```

является:

```
+------------------+------------------+------------------+
| UPPER('beegeek') | UPPER('BeeGeek') | UPPER('BEEGEEK') |
+------------------+------------------+------------------+
| BEEGEEK          | BEEGEEK          | BEEGEEK          |
+------------------+------------------+------------------+
```

<hr>

[Содержание](#содержание)

## Функции `LTRIM()` и `RTRIM()`

Функция `LTRIM()` используется для отсечения ведущих пробелов. Она принимает в качестве аргумента строку, удаляет все пробелы из ее левой части и возвращает полученный результат.

Результатом приведенного ниже запроса:

```sql
SELECT LTRIM(' bee'),
       LTRIM('  bee'),
       LTRIM('   bee');
```

является:

```
+---------------+----------------+-----------------+
| LTRIM(' bee') | LTRIM('  bee') | LTRIM('   bee') |
+---------------+----------------+-----------------+
| bee           | bee            | bee             |
+---------------+----------------+-----------------+
```

Похожим образом работает функция `RTRIM()` за исключением того, что она удаляет пробелы из правой части строки, а не левой.

<hr>

[Содержание](#содержание)

## Функция `REVERSE()`

Функция `REVERSE()` используется для переворота строки. Она принимает в качестве аргумента строку и возвращает ее с обратным порядком символов.

Результатом приведенного ниже запроса:

```sql
SELECT REVERSE('b'),
       REVERSE('bee'),
       REVERSE('beegeek');
```

является:

```
+--------------+----------------+--------------------+
| REVERSE('b') | REVERSE('bee') | REVERSE('beegeek') |
+--------------+----------------+--------------------+
| b            | eeb            | keegeeb            |
+--------------+----------------+--------------------+
```

<hr>

[Содержание](#содержание)

## Функция `REPEAT()`

Функция `REPEAT()` используется для повторения строки. Она принимает два аргумента в следующем порядке:
+ `str` — исходная строка
+ `count` — количество повторений

Функция возвращает строку, состоящую из строки `str`, повторяющейся `count` раз.

Результатом приведенного ниже запроса:

```sql
SELECT REPEAT('bee', 1),
       REPEAT('bee', 2),
       REPEAT('bee', 3);
```

является:

```
+------------------+------------------+------------------+
| REPEAT('bee', 1) | REPEAT('bee', 2) | REPEAT('bee', 3) |
+------------------+------------------+------------------+
| bee              | beebee           | beebeebee        |
+------------------+------------------+------------------+
```

Если количество повторов меньше 1, то функция `REPEAT()` вернет пустую строку.

Результатом приведенного ниже запроса:

```sql
SELECT REPEAT('bee', 0),
       REPEAT('bee', -1);
```

является:

```
+------------------+-------------------+
| REPEAT('bee', 0) | REPEAT('bee', -1) |
+------------------+-------------------+
|                  |                   |
+------------------+-------------------+
```

<hr>

[Содержание](#содержание)

## Функции `LPAD()` и `RPAD()`

Функция `LPAD()` используется для увеличения длины строки до определенного значения путем добавления в ее начало другой строки. Она принимает три аргумента в следующем порядке:

+ `str` — исходная строка
+ `len` — желаемая длина строки
+ `padstr` — дополняющая строка

Функция добавляет строку `padstr` в начало строки `str` до тех пор, пока длина второй не станет равна `len`, и возвращает полученный результат.

Результатом приведенного ниже запроса:

```sql
SELECT LPAD('bee', 5, '-'),
       LPAD('bee', 7, '-'),
       LPAD('bee', 9, '-+');
```
является:

```
+---------------------+---------------------+----------------------+
| LPAD('bee', 5, '-') | LPAD('bee', 7, '-') | LPAD('bee', 9, '-+') |
+---------------------+---------------------+----------------------+
| --bee               | ----bee             | -+-+-+bee            |
+---------------------+---------------------+----------------------+
```

Если длина исходной строки после добавления в ее начало дополняющей строки превышает желаемую длину, то функция `LPAD()` сокращает дополняющую строку путем отбрасывания правых символов.

Результатом приведенного ниже запроса:

```sql
SELECT LPAD('bee', 4, '-+-+'),
       LPAD('bee', 5, '-+-+'),
       LPAD('bee', 6, '-+-+');
```

является:

```
+------------------------+------------------------+------------------------+
| LPAD('bee', 4, '-+-+') | LPAD('bee', 5, '-+-+') | LPAD('bee', 6, '-+-+') |
+------------------------+------------------------+------------------------+
| -bee                   | -+bee                  | -+-bee                 |
+------------------------+------------------------+------------------------+
```

Если желаемая длина строки меньше длины исходной строки, то функция `LPAD()` сокращает исходную строку путем отбрасывания правых символов.

Результатом приведенного ниже запроса:

```sql
SELECT LPAD('bee', 2, '-'),
       LPAD('bee', 1, '-');
```

является:

```
+---------------------+---------------------+
| LPAD('bee', 2, '-') | LPAD('bee', 1, '-') |
+---------------------+---------------------+
| be                  | b                   |
+---------------------+---------------------+
```

Похожим образом себя ведет функция `RPAD()` за исключением того, что она дополняет строку не слева, а справа.

Результатом приведенного ниже запроса:

```sql
SELECT RPAD('bee', 5, '-'),
       RPAD('bee', 7, '-+'),
       RPAD('bee', 6, '-+-+'),
       RPAD('bee', 2, '-');
```

является: 

```sql
+---------------------+----------------------+------------------------+---------------------+
| RPAD('bee', 5, '-') | RPAD('bee', 7, '-+') | RPAD('bee', 6, '-+-+') | RPAD('bee', 2, '-') |
+---------------------+----------------------+------------------------+---------------------+
| bee--               | bee-+-+              | bee-+-                 | be                  |
+---------------------+----------------------+------------------------+---------------------+
```

<hr>

[Содержание](#содержание)

## Примечания 1

**Примечание 1.** Функции могут применяться как в блоке оператора `SELECT`, так и в блоках операторов `WHERE` и `ORDER BY`.

Предположим, во время работы с персональными данными людей нам необходимо выполнить их сортировку по именам, хранящимся в поле name, однако сортировка должна происходить не по прямым значениям имен, а по количеству символов в них. В рамках запроса такой вариант сортировки будет выглядеть следующим образом:

```sql
...
ORDER BY CHAR_LENGTH(name);
```

**Примечание 2.** Одним из недостатков функций является то, что в разных СУБД могут применяться разные функции для одних и тех же целей, и лишь некоторые функции в различных СУБД называются одинаково. Общая функциональность доступна в каждой СУБД, но названия функций и их синтаксис могут существенно отличаться. 

**Примечание 3.** Функции `CHAR_LENGTH()`, `LOWER()`, `UPPER()`, `LTRIM()`, `RTRIM()`, `REVERSE()`, `REPEAT()`, `LPAD()` и `RPAD()` при вызове с аргументом `NULL` возвращают значение `NULL`.

Результатом приведенного ниже запроса:

```sql
SELECT CHAR_LENGTH(NULL)  AS value1,
       LOWER(NULL)        AS value2,
       UPPER(NULL)        AS value3,
       LTRIM(NULL)        AS value4,
       REVERSE(NULL)      AS value5,
       REPEAT(NULL, 2)    AS value6,
       LPAD(NULL, 5, '-') AS value7;
```

является:

```
+--------+--------+--------+--------+--------+--------+--------+
| value1 | value2 | value3 | value4 | value5 | value6 | value7 |
+--------+--------+--------+--------+--------+--------+--------+
| NULL   | NULL   | NULL   | NULL   | NULL   | NULL   | NULL   |
+--------+--------+--------+--------+--------+--------+--------+
```

**Примечание 4.** Несмотря на то что функции `CHAR_LENGTH()`, `REVERSE()`, `REPEAT()`, `LPAD()` и `RPAD()` в первую очередь предназначены для работы со строковыми значениями, они также могут обрабатывать и числовые данные.

Результатом приведенного ниже запроса:

```sql
SELECT CHAR_LENGTH(123),
       REVERSE(123),
       REPEAT(123, 2),
       LPAD(123, 4, '-');
```

является:

```
+------------------+--------------+----------------+-------------------+
| CHAR_LENGTH(123) | REVERSE(123) | REPEAT(123, 2) | LPAD(123, 4, '-') |
+------------------+--------------+----------------+-------------------+
| 3                | 321          | 123123         | -123              |
+------------------+--------------+----------------+-------------------+
```

<hr>

[Содержание](#содержание)

## Примеры использования функций 1

В начале урока мы рассмотрели примеры использования функций, в которых они применяются к конкретным значениям. В связи с этим у многих из вас возникли сложности с применением функций к полям таблицы, поэтому мы решили добавить несколько таких примеров.

**Используемая база данных**

Перед тем как приступить к рассмотрению примеров, рассмотрим базу данных, которая будет использоваться в последующих примерах. Она состоит из одной таблицы с именем Songs, которая содержит информацию о пяти наиболее популярных песнях на некоторой площадке для прослушивания музыки:

```
+----+-------+----------------------+------------+---------+
| id | place | trackname            | artist     | streams |
+----+-------+----------------------+------------+---------+
| 1  | 4     | Crazy On You         | Heart      | 76338   |
| 2  | 3     | My Lover             | The Sounds | 99488   |
| 3  | 2     | Running up That Hill | Kate Bush  | 121495  |
| 4  | 5     | Thrill               | The Sounds | 49345   |
| 5  | 1     | Spent the Day in Bed | Morrissey  | 174994  |
+----+-------+----------------------+------------+---------+
```

Первое поле этой таблицы содержит уникальный идентификатор песни, второе — позицию песни в топе, третье — название песни, четвертое — псевдоним исполнителя или название группы, пятое — количество прослушиваний.

Скрипт для создания таблицы Songs

```sql
DROP TABLE IF EXISTS Songs;
CREATE TABLE Songs
(
    id        INT PRIMARY KEY AUTO_INCREMENT,
    place     INT,
    trackname VARCHAR(30),
    artist    VARCHAR(30),
    streams   INT
);

INSERT INTO Songs (place, trackname, artist, streams)
VALUES (4, 'Crazy On You', 'Heart', 76338),
       (3, 'My Lover', 'The Sounds', 99488),
       (2, 'Running up That Hill', 'Kate Bush', 121495),
       (5, 'Thrill', 'The Sounds', 49345),
       (1, 'Spent the Day in Bed', 'Morrissey', 174994);
```

## Применение функций 1

Для того, чтобы применить функцию к полю таблицы, достаточно просто указать это поле в качестве аргумента функции. Давайте рассмотрим несколько примеров.

**Пример 1.** Необходимо извлечь имена исполнителей, а также посчитать количество символов в именах исполнителей. Для этого мы можем использовать функцию `CHAR_LENGTH()`.

Результатом приведенного ниже запроса:

```sql
SELECT artist, CHAR_LENGTH(artist) AS length
FROM Songs;
```

является:

```
+------------+--------+
| artist     | length |
+------------+--------+
| Heart      | 5      |
| The Sounds | 10     |
| Kate Bush  | 9      |
| The Sounds | 10     |
| Morrissey  | 9      |
+------------+--------+
```

**Пример 2.** Необходимо извлечь имена исполнителей и названия их песен, при этом названия песен должны быть отображены в нижнем регистре. Для этого мы можем использовать функцию `LOWER()`.

Результатом приведенного ниже запроса:

```sql
SELECT artist, LOWER(trackname) AS trackname
FROM Songs;
```

является:

```
+------------+----------------------+
| artist     | trackname            |
+------------+----------------------+
| Heart      | crazy on you         |
| The Sounds | my lover             |
| Kate Bush  | running up that hill |
| The Sounds | thrill               |
| Morrissey  | spent the day in bed |
+------------+----------------------+
```

**Пример 3.** Необходимо извлечь имена исполнителей и названия их песен, при этом названия песен должны быть отображены в верхнем регистре в обратном порядке. Для этого мы можем использовать функции `UPPER()` и `REVERSE()`.

Результатом приведенного ниже запроса:

```sql
SELECT artist, REVERSE(UPPER(trackname)) AS trackname
FROM Songs;
```

является:

```
+------------+----------------------+
| artist     | trackname            |
+------------+----------------------+
| Heart      | UOY NO YZARC         |
| The Sounds | REVOL YM             |
| Kate Bush  | LLIH TAHT PU GNINNUR |
| The Sounds | LLIRHT               |
| Morrissey  | DEB NI YAD EHT TNEPS |
+------------+----------------------+
```

Результатом выполнения функции является определенное значение, поэтому функцию можно использовать в качестве аргумента другой функции. В этом примере сначала функция `UPPER()` переводит строку в верхний регистр, а затем функция `REVERSE()` переворачивает эту строку. При этом, если поменять функции местами, результат не изменится.

Результатом приведенного ниже запроса:

```sql
SELECT artist, UPPER(REVERSE(trackname)) AS trackname
FROM Songs;
```

является:

```
+------------+----------------------+
| artist     | trackname            |
+------------+----------------------+
| Heart      | UOY NO YZARC         |
| The Sounds | REVOL YM             |
| Kate Bush  | LLIH TAHT PU GNINNUR |
| The Sounds | LLIRHT               |
| Morrissey  | DEB NI YAD EHT TNEPS |
+------------+----------------------+
```

Разница заключается лишь в том, что сначала выполнится функция `REVERSE()`, а только потом `UPPER()`. Но при перестановке функций результат не всегда будет одинаковым, в некоторых случаях порядок вложения функций нужно соблюдать.

**Пример 4.** Необходимо извлечь имена исполнителей, при этом каждое имя необходимо развернуть, а затем дополнить символом ! с начала строки до длины 20. Для этого мы можем использовать функции `REVERSE()` и `LPAD()`.

Результатом приведенного ниже запроса:

```sql
SELECT artist, LPAD(REVERSE(artist), 20, '!') AS result
FROM Songs;
```

является:

```
+------------+----------------------+
| artist     | result               |
+------------+----------------------+
| Heart      | !!!!!!!!!!!!!!!traeH |
| The Sounds | !!!!!!!!!!sdnuoS ehT |
| Kate Bush  | !!!!!!!!!!!hsuB etaK |
| The Sounds | !!!!!!!!!!sdnuoS ehT |
| Morrissey  | !!!!!!!!!!!yessirroM |
+------------+----------------------+
```

В этом примере сначала функция `REVERSE()` переворачивает строку, а затем функция `LPAD()` дополняет ее символом `!`. Это пример того, где порядок вложения функций имеет значение. Если мы поменяем функции местами, результат уже будет другим.

Результатом приведенного ниже запроса:

```sql
SELECT artist, REVERSE(LPAD(artist, 20, '!')) AS result
FROM Songs;
```

является:

```
+------------+----------------------+
| artist     | result               |
+------------+----------------------+
| Heart      | traeH!!!!!!!!!!!!!!! |
| The Sounds | sdnuoS ehT!!!!!!!!!! |
| Kate Bush  | hsuB etaK!!!!!!!!!!! |
| The Sounds | sdnuoS ehT!!!!!!!!!! |
| Morrissey  | yessirroM!!!!!!!!!!! |
+------------+----------------------+
```

<hr>

[Содержание](#содержание)

# 4.2 Текстовые функции. Часть 2

<hr>

[Содержание](#содержание)

# 4.3 Текстовые функции. Часть 3

<hr>

[Содержание](#содержание)

# 4.4 Числовые функции. Часть 1

<hr>

[Содержание](#содержание)

# 4.5 Числовые функции. Часть 2

<hr>

[Содержание](#содержание)

# 4.6 Функции даты и времени. Часть 1

<hr>

[Содержание](#содержание)

# 4.7 Функции даты и времени. Часть 2

<hr>

[Содержание](#содержание)

# 4.8 Функции даты и времени. Часть 3

<hr>

[Содержание](#содержание)

# 4.9 Функции даты и времени. Часть 4

<hr>

[Содержание](#содержание)

# 4.10 Дополнительные функции

<hr>

[Содержание](#содержание)

# 4.11 Условные конструкции

<hr>

[Содержание](#содержание)


<hr>

[Содержание](#содержание)