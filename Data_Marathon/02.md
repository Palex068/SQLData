# 2. Введение в базы данных

## Содержание

+ [2.1 Первый запрос в SQL](#21-первый-запрос-в-sql)
+ [2.2 Откуда берутся таблицы](#22-откуда-берутся-таблицы)
+ [2.3 Базы данных и SQL](#23-базы-данных-и-sql)

[Оглавление](/Data_Marathon/README.md)

# 2.1 Первый запрос в SQL

Как мы уже говорили ранее, один из основных инструментов аналитика — SQL. Позже мы расскажем, что это такое и как с ним работать, а пока напишем самый простой запрос.

Скопируйте в поле ниже этот текст и нажмите «Отправить». Здесь вы можете посмотреть, как работать с такими заданиями.

```sql
SELECT 'Привет, мир!' AS result
```

Поздравляем, вы только что выполнили свой первый запрос в SQL!

```sql
SELECT 'Привет, мир!' AS result
```

Вы наверняка заметили, что результатом запроса оказалась таблица с названием столбца «result»:


|   result   |
|:----------:|
|Привет, мир!|

Давайте подробно разберем как же отработал наш код и почему мы получили такой результат.

В этом запросе мы использовали только одну команду — `SELECT`, которая в переводе с английского значит «Выбери», а в нашем случае может быть интерпретирована как «Покажи». Такие команды еще называют операторами. Операторы — это слова или символы, которые указывают какое действие выполнять.

В коде мы еще используем оператор `AS`. Он используется для наименования столбцов в выводе. В нашем случае столбец стал называться result благодаря AS.

То есть, мы буквально сказали компьютеру: «Покажи мне фразу “Привет, мир!” и назови этот столбец `result`». 

А теперь проверьте, как будет называться столбец, если мы не будем давать ему название. Скопируйте код в поле ниже и нажмите отправить:

```sql
SELECT 'Привет, мир!'
```

Наименование столбца будет таким, как указано в части `SELECT`. В данном случае мы никак не переименовывали наш выводимый столбец с помощью оператора `AS`, поэтому его название «Привет, мир!».

```
+--------------+
| Привет, мир! |
+--------------+
| Привет, мир! |
+--------------+
```

Мы можем попросить оператор `SELECT` «показать» нам почти всё, что угодно: дату, время, слово, число и даже сумму чисел.

Давайте попробуем вывести число. Скопируйте код в поле ниже и нажмите «Отправить», чтобы пройти проверку.

```sql
SELECT 21657 AS result
```

​​Вы можете потренироваться выводить разные числа. Для этого поменяйте число в коде и нажмите «Запустить код», чтобы увидеть результат​​​​​.

```
+--------+
| result |
+--------+
| 21657  |
+--------+
```

Отлично, запросы с числами тоже работают! Предлагаем перемножить парочку.

Вставьте в окно ниже эту строку и нажмите «Отправить», чтобы пройти проверку:

```sql
SELECT 101010 * 7 AS result
```

Как и ранее, Вы можете взять любые числа, чтобы потренироваться выводить их произведение. Для этого поменяйте числа в коде и нажмите «Запустить код», чтобы увидеть результат​​​​​.

```
+--------+
| result |
+--------+
| 707070 |
+--------+
```

Любой язык программирования можно использовать в качестве калькулятора — и SQL не исключение! Но нас интересует решение более интересных задач, из которых в том числе складывается отчет создателю игры «Save the Milky Way» — вы о нем еще не забыли?

Для отчета нам, кстати, понадобятся игровые данные пользователей. Давайте взглянем на них, они находятся в таблице game_events. Для этого скопируйте в поле ниже новую команду и нажмите «Отправить»:

```sql
SELECT *
FROM game_events
```

Про оператор `FROM` и оператор «*» (в данном случае это не умножение) мы расскажем Вам чуть позже. Сначала мы объясним откуда же берутся таблицы.

```
+----------+------------------------+------------+---------------+------------+---------+
| user_id  | event_name             | level_name | level_success | event_date | revenue |
+----------+------------------------+------------+---------------+------------+---------+
| 7f0344f8 | in_app_purchase        | NULL       | NULL          | 2021-01-10 | 0.99    |
| 7f0344f8 | daily_game_events      | NULL       | NULL          | 2021-01-10 | NULL    |
| 7f0344f8 | daily_battle_victories | NULL       | NULL          | 2021-01-10 | NULL    |
| 00aa49ac | level_end              | level_01   | 1             | 2021-01-13 | NULL    |
| 00aa49ac | level_end              | level_02   | 1             | 2021-01-13 | NULL    |
| 00aa49ac | level_start            | level_01   | NULL          | 2021-01-13 | NULL    |
| 00aa49ac | level_start            | level_03   | NULL          | 2021-01-14 | NULL    |
| 00aa49ac | level_start            | level_02   | NULL          | 2021-01-13 | NULL    |
| 00aa49ac | in_app_purchase        | NULL       | NULL          | 2021-01-13 | 2.49    |
| 00aa49ac | in_app_purchase        | NULL       | NULL          | 2021-01-14 | 9.49    |
| 00aa49ac | in_app_purchase        | NULL       | NULL          | 2021-01-13 | 7.49    |
| 00aa49ac | in_app_purchase        | NULL       | NULL          | 2021-01-13 | 9.49    |
| 00aa49ac | daily_game_events      | NULL       | NULL          | 2021-01-13 | NULL    |
| 00aa49ac | daily_game_events      | NULL       | NULL          | 2021-01-14 | NULL    |
| 00aa49ac | daily_battle_victories | NULL       | NULL          | 2021-01-14 | NULL    |
| 00aa49ac | daily_battle_victories | NULL       | NULL          | 2021-01-13 | NULL    |
| f5ef9841 | level_end              | level_02   | 1             | 2021-01-16 | NULL    |
| f5ef9841 | level_end              | level_03   | 1             | 2021-01-16 | NULL    |
| f5ef9841 | level_end              | level_04   | 1             | 2021-01-16 | NULL    |
| f5ef9841 | level_end              | level_01   | 1             | 2021-01-15 | NULL    |
| f5ef9841 | level_start            | level_03   | NULL          | 2021-01-16 | NULL    |
| f5ef9841 | level_start            | level_04   | NULL          | 2021-01-16 | NULL    |
| f5ef9841 | level_start            | level_01   | NULL          | 2021-01-15 | NULL    |
| f5ef9841 | level_start            | level_02   | NULL          | 2021-01-16 | NULL    |
| f5ef9841 | level_start            | level_02   | NULL          | 2021-01-15 | NULL    |
| f5ef9841 | app_first_launch       | NULL       | NULL          | 2021-01-15 | NULL    |
| f5ef9841 | in_app_purchase        | NULL       | NULL          | 2021-01-15 | 7.49    |
| f5ef9841 | in_app_purchase        | NULL       | NULL          | 2021-01-15 | 2.49    |
| f5ef9841 | in_app_purchase        | NULL       | NULL          | 2021-01-16 | 9.49    |
| f5ef9841 | daily_game_events      | NULL       | NULL          | 2021-01-16 | NULL    |
| f5ef9841 | daily_game_events      | NULL       | NULL          | 2021-01-15 | NULL    |
| f5ef9841 | daily_battle_victories | NULL       | NULL          | 2021-01-16 | NULL    |
| f5ef9841 | daily_battle_victories | NULL       | NULL          | 2021-01-15 | NULL    |
| 13d17d67 | level_end              | level_05   | 1             | 2021-01-13 | NULL    |
| 13d17d67 | level_start            | level_05   | NULL          | 2021-01-13 | NULL    |
| 13d17d67 | in_app_purchase        | NULL       | NULL          | 2021-01-13 | 9.47674 |
| 13d17d67 | in_app_purchase        | NULL       | NULL          | 2021-01-15 | 7.07912 |
| 13d17d67 | in_app_purchase        | NULL       | NULL          | 2021-01-13 | 2.36029 |
| 13d17d67 | daily_game_events      | NULL       | NULL          | 2021-01-15 | NULL    |
| 13d17d67 | daily_game_events      | NULL       | NULL          | 2021-01-17 | NULL    |
| 13d17d67 | daily_game_events      | NULL       | NULL          | 2021-01-13 | NULL    |
| 13d17d67 | daily_battle_victories | NULL       | NULL          | 2021-01-17 | NULL    |
| 13d17d67 | daily_battle_victories | NULL       | NULL          | 2021-01-15 | NULL    |
| 13d17d67 | daily_battle_victories | NULL       | NULL          | 2021-01-13 | NULL    |
+----------+------------------------+------------+---------------+------------+---------+
```

Если привести результат предыдущего запроса к привычному нам виду, то получится такая табличка:

user_id | event_name | level_name | level_success | event_date | revenue
-- | -- | -- | -- | -- | --
7f0344f8 | in_app_purchase | null | null | 2021-01-10 | 0.99
7f0344f8 | daily_game_events | null | null | 2021-01-10 | null
7f0344f8 | daily_battle_victories | null | null | 2021-01-10 | null
00aa49ac | level_end | level_01 | 1 | 2021-01-13 | null
00aa49ac | level_end | level_02 | 1 | 2021-01-13 | null
00aa49ac | level_start | level_01 | null | 2021-01-13 | null
00aa49ac | level_start | level_03 | null | 2021-01-14 | null
00aa49ac | level_start | level_02 | null | 2021-01-13 | null
00aa49ac | in_app_purchase | null | null | 2021-01-13 | 2.49
00aa49ac | in_app_purchase | null | null | 2021-01-14 | 9.49
00aa49ac | in_app_purchase | null | null | 2021-01-13 | 7.49
00aa49ac | daily_game_events | null | null | 2021-01-13 | null
00aa49ac | daily_battle_victories | null | null | 2021-01-13 | null

Подробное [описание полей таблицы](https://docs.google.com/document/d/1lTNa5DINxjoBknKxJT516qnc4dXwwm5E/edit) game_events вы можете посмотреть, нажав на кнопку ниже:

Вы точно раньше уже сталкивались с таблицами: мы ведем в них семейные бюджеты, ставим оценки студентам, смотрим расписание автобусов или поездов, и т.д. Таблицы буквально окружают нас, а еще они — **самая распространенная форма представления данных**, с которыми работают аналитики. Именно над таблицами мы будем проводить различные эксперименты в течение всего нашего курса.

Давайте познакомимся с ними поближе!

<hr>

[Содержание](#содержание)

# 2.2 Откуда берутся таблицы

Чтобы понять, откуда берутся данные и как они складываются в таблицы, давайте представим следующую ситуацию: перед нами стоит до боли знакомая задача очистить балкон от хлама, который там скопился за несколько лет. Как мы поступим?

![02](/Data_Marathon/img/02_01.png)

Для начала переберем все ящики и пакеты, проверим все коробочки и дальние углы. В процессе этой ревизии вещи, которые стоит выкинуть, мы положим в одну сторону, а те, которые стоит оставить — в другую. Наверняка у нас будет еще и третья куча вещей — та самая, которую выкидывать жалко, но и хранить уже не хочется.

Весь этот процесс обычно отнимает много времени и сил. Как можно заранее упростить себе жизнь?

К примеру, можно вести учет каждой вещи, которая попадёт на балкон:

![02](/Data_Marathon/img/02_02.jpg)

Насколько этот перечень будет для нас информативным? Возможно, он поможет на самом раннем этапе определиться со списком вещей, которые мы выбросим.

Какие еще данные были бы нам полезны? Например, мы точно знаем, что хотим выкинуть старый сдутый футбольный мяч. Но где он лежит на балконе? Тут наши поиски смог бы ускорить столбец «Где лежит»:

![02](/Data_Marathon/img/02_03.jpg)

Выглядит более обнадеживающе, правда?

Попробуем упростить разбор балкона еще немного.

Что делать, если мы хотим выкинуть весь старый спортивный инвентарь? В таком случае нам пригодятся сразу два новых столбца в таблице.

Первый из них — категория предмета. С таким столбцом мы сразу сможем увидеть, какого рода предметы есть на балконе, выбрать из них только спортивный инвентарь и еще на шаг приблизиться к решению нашей проблемы.

![02](/Data_Marathon/img/02_04.jpg)

Следующий шаг — столбец «Дата», который будет показывать, когда именно этот предмет попал на балкон. Так мы сможем определить старый спортивный инвентарь и, наконец, расстаться с ним:

![02](/Data_Marathon/img/02_05.jpg)

Взглянем еще раз на таблицу, которую мы только что создали:

![02](/Data_Marathon/img/02_06.jpg)

Кажется, тут есть вся необходимая информация о нашем складе на балконе. Теперь не придется выделять целый выходной на сортировку старых и вроде бы еще нужных вещей: можно просто заглянуть в таблицу и действовать.

Но где хранить саму таблицу?

<hr>

[Содержание](#содержание)

# 2.3 Базы данных и SQL

На первый взгляд может показаться, что табличка с балконным хламом — дело простое, и особенно раздумывать о ее хранении не нужно. Например, можно прибегнуть к «дедовским» методам и записать все на самом обычном листе бумаги или даже завести журнал. Можно пойти более современным путем и создать список вещей в заметках в телефоне или в чате с самим собой в любимом мессенджере.

Эти подходы сработают, если на вашем балконе стоит пара цветочных горшков и велосипед, а кроме вас туда никто не заходит.

Но представьте, что вы живете в большой семье, где каждый если не складывает периодически на балкон свои старые лыжи, то точно умудряется уронить и поставить в другой угол ваши, которым в том самом журнале строго отведено место «Слева от входа, между стеной и шкафом».

А если переезд? А вдруг кто-то заменил ваши лыжи на другие и не записал это в журнал? А если вещей стало так много, что часть пришлось перевезти в гараж? А вы точно вычеркнули из журнала всё, что выбросили в прошлый раз?

![02](/Data_Marathon/img/02_07.png)

Иными словами, со временем записей становится слишком много, а управлять ими — всё труднее. Вести такую таблицу вручную будет не эффективнее, чем закопаться в вещах на день и все разобрать.

Поэтому люди и придумали базы данных. Они позволяют нам хранить сколько угодно таблиц с нужной информацией в одном месте, связывать их между собой, а также производить над ними любые операции.

А еще базы данных решают проблему добавления новых записей: каждый раз, когда происходит какое-либо событие, в соответствующую таблицу автоматически вставляется новая строка со всеми необходимыми данными. Только представьте: при очередном перемещении лыж из одного угла балкона в другой в нашей табличке без чьего-либо участия обновлялась бы информация об этих самых лыжах. Магия, не иначе!

![02](/Data_Marathon/img/02_08.png)

Для работы с базами данных используется язык программирования SQL — Structured Query Language, буквально «язык запросов».

С помощью SQL можно создавать таблицы и заполнять их данными, как мы делали это с вами в предыдущих уроках, когда описывали вещи на балконе. Для каждой такой операции в языке предусмотрена команда (или оператор) и какой-то набор правил о том, что указывается вместе с ней.

Если вы знакомы с английским языком, то почти все команды будут вам интуитивно понятны. Например, создать таблицу можно с помощью `CREATE TABLE`, а добавить в нее данные — командой `INSERT`. Но эту магию мы оставим для продвинутого курса, нам же с вами пока хватит операторов, с которыми мы уже встречались: `SELECT` и `FROM`.

Таблица про вещи на балконе в базе данных могла бы храниться с именем balcony_stuff, а запрос для просмотра списка вещей в SQL выглядел бы так:

```sql
SELECT *
FROM balcony_stuff
```

```
+---------------------------+----------------------+----------------------+------------+
| item                      | location             | category             | date_event |
+---------------------------+----------------------+----------------------+------------+
| скейтборд                 | слева от входа, ...  | спортивный инвентарь | 2022-08-31 |
| футбольный мяч (сдутый)   | справа от входа, ... | спортивный инвентарь | 2019-06-10 |
| сканер                    | справа от входа, ... | техника              | 2009-11-03 |
| коробка с газетами        | справа от входа, ... | макулатура           | 2021-01-11 |
| коробка с детской одеждой | справа от входа, ... | одежда               | 2020-10-07 |
+---------------------------+----------------------+----------------------+------------+
```

Самое время разобраться, что тут происходит. Переводим с SQL на русский:

Новое открытие: символ «*» означает «все столбцы». В итоге получается следующее: «Выбери все столбцы из таблицы balcony_stuff».

`SELECT` и `FROM` — главные операторы для работы с базой данных. `FROM` показывает, откуда именно мы берем данные, а `SELECT` выбирает их и производит некоторые нужные нам операции.

Давайте вернемся к таблице по игре. Cкопируйте в поле ниже эти строки и нажмите «Отправить»:

```sql
SELECT *
FROM game_events
```

```
+----------+------------------------+------------+---------------+------------+---------+
| user_id  | event_name             | level_name | level_success | event_date | revenue |
+----------+------------------------+------------+---------------+------------+---------+
| 7f0344f8 | in_app_purchase        | NULL       | NULL          | 2021-01-10 | 0.99    |
| 7f0344f8 | daily_game_events      | NULL       | NULL          | 2021-01-10 | NULL    |
| 7f0344f8 | daily_battle_victories | NULL       | NULL          | 2021-01-10 | NULL    |
| 00aa49ac | level_end              | level_01   | 1             | 2021-01-13 | NULL    |
| 00aa49ac | level_end              | level_02   | 1             | 2021-01-13 | NULL    |
| 00aa49ac | level_start            | level_01   | NULL          | 2021-01-13 | NULL    |
| 00aa49ac | level_start            | level_03   | NULL          | 2021-01-14 | NULL    |
| 00aa49ac | level_start            | level_02   | NULL          | 2021-01-13 | NULL    |
| 00aa49ac | in_app_purchase        | NULL       | NULL          | 2021-01-13 | 2.49    |
| 00aa49ac | in_app_purchase        | NULL       | NULL          | 2021-01-14 | 9.49    |
| 00aa49ac | in_app_purchase        | NULL       | NULL          | 2021-01-13 | 7.49    |
| 00aa49ac | in_app_purchase        | NULL       | NULL          | 2021-01-13 | 9.49    |
| 00aa49ac | daily_game_events      | NULL       | NULL          | 2021-01-13 | NULL    |
| 00aa49ac | daily_game_events      | NULL       | NULL          | 2021-01-14 | NULL    |
| 00aa49ac | daily_battle_victories | NULL       | NULL          | 2021-01-14 | NULL    |
| 00aa49ac | daily_battle_victories | NULL       | NULL          | 2021-01-13 | NULL    |
| f5ef9841 | level_end              | level_02   | 1             | 2021-01-16 | NULL    |
| f5ef9841 | level_end              | level_03   | 1             | 2021-01-16 | NULL    |
| f5ef9841 | level_end              | level_04   | 1             | 2021-01-16 | NULL    |
| f5ef9841 | level_end              | level_01   | 1             | 2021-01-15 | NULL    |
| f5ef9841 | level_start            | level_03   | NULL          | 2021-01-16 | NULL    |
| f5ef9841 | level_start            | level_04   | NULL          | 2021-01-16 | NULL    |
| f5ef9841 | level_start            | level_01   | NULL          | 2021-01-15 | NULL    |
| f5ef9841 | level_start            | level_02   | NULL          | 2021-01-16 | NULL    |
| f5ef9841 | level_start            | level_02   | NULL          | 2021-01-15 | NULL    |
| f5ef9841 | app_first_launch       | NULL       | NULL          | 2021-01-15 | NULL    |
| f5ef9841 | in_app_purchase        | NULL       | NULL          | 2021-01-15 | 7.49    |
| f5ef9841 | in_app_purchase        | NULL       | NULL          | 2021-01-15 | 2.49    |
| f5ef9841 | in_app_purchase        | NULL       | NULL          | 2021-01-16 | 9.49    |
| f5ef9841 | daily_game_events      | NULL       | NULL          | 2021-01-16 | NULL    |
| f5ef9841 | daily_game_events      | NULL       | NULL          | 2021-01-15 | NULL    |
| f5ef9841 | daily_battle_victories | NULL       | NULL          | 2021-01-16 | NULL    |
| f5ef9841 | daily_battle_victories | NULL       | NULL          | 2021-01-15 | NULL    |
| 13d17d67 | level_end              | level_05   | 1             | 2021-01-13 | NULL    |
| 13d17d67 | level_start            | level_05   | NULL          | 2021-01-13 | NULL    |
| 13d17d67 | in_app_purchase        | NULL       | NULL          | 2021-01-13 | 9.47674 |
| 13d17d67 | in_app_purchase        | NULL       | NULL          | 2021-01-15 | 7.07912 |
| 13d17d67 | in_app_purchase        | NULL       | NULL          | 2021-01-13 | 2.36029 |
| 13d17d67 | daily_game_events      | NULL       | NULL          | 2021-01-15 | NULL    |
| 13d17d67 | daily_game_events      | NULL       | NULL          | 2021-01-17 | NULL    |
| 13d17d67 | daily_game_events      | NULL       | NULL          | 2021-01-13 | NULL    |
| 13d17d67 | daily_battle_victories | NULL       | NULL          | 2021-01-17 | NULL    |
| 13d17d67 | daily_battle_victories | NULL       | NULL          | 2021-01-15 | NULL    |
| 13d17d67 | daily_battle_victories | NULL       | NULL          | 2021-01-13 | NULL    |
+----------+------------------------+------------+---------------+------------+---------+
```

Между нами и переходом к самым настоящим бизнесовым задачам остался один маленький шаг: понять, что таит в себе каждая ячейка наших данных.

Любая таблица состоит из столбцов. Каждый из столбцов хранит в себе данные конкретного типа. Каждый из типов данных позволяет производить определенные операции. Вряд ли вы планировали делить слово «привет» на ноль, правда?

В SQL тип данных для каждого нового столбца нужно определить еще до того, как вы начали эти данные собирать: именно так мы поступили пару уроков назад, когда решили для вещей указывать момент их появления на балконе — в этом столбце у нас записаны только даты.

С основными типами данных вы уже встречались в этом курсе, так что давайте просто повторим и уточним некоторые детали. Итак, для финального отчета нам понадобятся:

1. Строки<br>
В столбцах строкового типа можно хранить текст. Например, «Привет, мир!» из первого урока по SQL. Строки можно объединять и разделять на несколько, сравнивать их по длине, менять регистр и многое другое. Для подготовки отчетов по игре все эти операции нам не понадобятся, но мы рассмотрим их на продвинутом курсе по SQL.

2. Числа<br>
В столбцах числового типа можно хранить только числа: например, целые (целочисленный тип данных) или дробные (числовой тип данных с плавающей точкой). Над числами можно производить любые математические операции и операции сравнения.

3. Даты<br>
В столбцах этого формата можно хранить только даты, причем в определенном формате — он определяется при создании столбца. Примеры форматов:

+ День.Месяц.Год (8 января 2022 будет записано как ‘08.01.2022’)
+ Месяц.День.Год (8 января 2022 будет записано как ‘01.08.2022’)
+ Год-Месяц-День (8 января 2022 будет записано как ‘2022-01-08’)

С датами можно также производить различные математические операции и операции сравнения.

Попробуйте определить, какие типы данных есть в таблице с событиями из игры.

Напомним, как она выглядит:

user_id | event_name | level_name | level_success | event_date | revenue
-- | -- | -- | -- | -- | --
7f0344f8 | in_app_purchase | null | null | 2021-01-10 | 0.99
7f0344f8 | daily_game_events | null | null | 2021-01-10 | null
7f0344f8 | daily_battle_victories | null | null | 2021-01-10 | null
00aa49ac | level_end | level_01 | 1 | 2021-01-13 | null
00aa49ac | level_end | level_02 | 1 | 2021-01-13 | null
00aa49ac | level_start | level_01 | null | 2021-01-13 | null
00aa49ac | level_start | level_03 | null | 2021-01-14 | null
00aa49ac | level_start | level_02 | null | 2021-01-13 | null
00aa49ac | in_app_purchase | null | null | 2021-01-13 | 2.49
00aa49ac | in_app_purchase | null | null | 2021-01-14 | 9.49
00aa49ac | in_app_purchase | null | null | 2021-01-13 | 7.49
00aa49ac | daily_game_events | null | null | 2021-01-13 | null
00aa49ac | daily_battle_victories | null | null | 2021-01-13 | null

>Небольшая подсказка: названия событий (event_name) и уровней (level_name) относятся к столбцам строкового типа.

![02](/Data_Marathon/img/02_09.PNG)

Вы наверняка заметили, что в предыдущем степе некоторые ячейки таблицы остались незаполненными. Такие значения называют `NULL`. 

`NULL` по смыслу является отсутствием информации, пустотой, а следовательно такое значение может встречаться в столбцах с любым типом данных. При этом 0 или знак пробела не являются `NULL` значениями, так как они несут в себе информацию. 

К примеру, если в столбце REVENUE стоит значение 0 — это означает, что пользователь заплатил 0 рублей (возможно была 100% скидка).

![02](/Data_Marathon/img/02_10.png)

<hr>

[Содержание](#содержание)