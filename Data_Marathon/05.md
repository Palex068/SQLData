# 5. Знакомство с Python

## Содержание

+ [5.1 Введение в Python: переменные и типы данных](#51-введение-в-python-переменные-и-типы-данных)
+ [5.2 Задача: планирование бюджета командировки](#52-задача-планирование-бюджета-командировки)
+ [5.3 Pandas: фильтрация данных](#53-pandas-фильтрация-данных)
+ [5.4 Pandas: агрегация данных](#54-pandas-агрегация-данных)

[Оглавление](/Data_Marathon/README.md)

# 5.1 Введение в Python: переменные и типы данных

SQL, с которым мы уже познакомились — это язык запросов, созданный для взаимодействия с базами данных. То есть для работы с SQL должна существовать некоторая база данных, в которую мы можем **обратиться**, для того, чтобы получить ту или иную информацию. Именно поэтому он называется языком запросов.

Несмотря на то, что с помощью SQL с данными можно сделать многое, в работе аналитика часто встречаются задачи, для решения которых возможностей SQL недостаточно. К примеру, бывает нужно построить график о выручке за каждый день на основе данных. SQL предоставляет возможность эти самые данные получить или посчитать, но сам график построить никак не получится. Или если базы данных вообще не существует, а существуют только файлы с данными в таблицах Excel, то SQL с этим тоже не справится.

Что же тогда делать? В таких случаях аналитики пользуются языками программирования, позволяющими решать задачи, связанные не только с обработкой данных, хранящихся в таблицах. Одним из самых широко используемых языков в аналитике является Python. В шестом модуле, после того как вы изучите основы этого языка программирования, мы более подробно разберем разницу между SQL и Python на примере из жизни команды **Valiotti Analytics**.

**Пример из жизни команды Valiotti Analytics**

Когда команда Valiotti Analytics создавала комьюнити [Cyprus Data](https://t.me/cyprusdatanews/8), перед нами стояла задача, которую было невозможно решить с помощью SQL: аналитическим путем найти целевую аудиторию и пригласить в Cyprus Data Chat. О самой задаче и ее решении можете почитать [в презентации](https://docs.google.com/presentation/d/1vet-WWuFuJXyeM3glc6FUA_JITMKQlg-/edit#slide=id.p1), а о дальнейшем развитии истории [в телеграме](https://t.me/leftjoin/838). В дальнейшем мы еще вернемся к этой задаче, чтобы немного подробнее поговорить о ней. 

Своей популярностью Python обязан в первую очередь простому (по сравнению с другими языками) синтаксису и большому количеству отличных и бесплатных библиотек (о них мы поговорим в следующих уроках). Например, чтобы вывести на экран фразу "Привет, мир!" в языке программирования JAVA необходимо написать 5 строчек кода, тогда как в Python достаточно всего одной! Давайте посмотрим как это выглядит. 

![05](/Data_Marathon/img/05_01.png)

Попробуйте выполнить свою первую программу в Python. Скопируйте в поле ниже строку и нажмите «Отправить», чтобы выполнить задание. Чтобы посмотреть вывод программы нажмите «Запустить код». [Здесь](https://stepik.org/lesson/736931/step/5?unit=738530) вы можете подробнее прочитать, как работать с такими заданиями.

```python
print('Привет, мир!')
```

>В отличие от SQL Python чувствителен к пробелам и отступам в начале строки. Не ставьте лишние пробелы в начале строки. Перенос строки делайте с помощью кнопки Enter. Если Вы получили синтаксическую ошибку с указанием некорректного места, проверьте, нет ли в указаном месте лишнего пробела.

Теперь давайте подробнее остановимся на том, что же такое язык программирования (ЯП) и зачем он нужен? 

В первую очередь, ЯП необходим для написания **алгоритмов**. Языки программирования придумывались для того, чтобы быстрее производить расчеты и делегировать ручную рутинную работу машине. SQL же является **языком запросов к базам данных** и нужен только для обработки данных в таблицах. 

Приведем пример такой рутинной работы. Перед нами стоит задача: рассчитать стоимость отпуска, чтобы запланировать бюджет. Как можно произвести такие расчеты? 

1. Первый способ – все в записной книжке.
    + Записать стоимость билетов, аренды жилья, транспорта, предполагаемые расходы на еду и т.д. Все необходимые расчеты произвести так же на листочке. И, согласно рассчитанной стоимости поездки, планировать бюджет. При любых изменениях в ценах придется пересчитывать все вручную и, возможно, тратить на это много времени.
2. Второй способ – заметки в телефоне + калькулятор. 
    + Суть аналогичная: все расходы заносим в заметки для фиксации, на основании них в калькуляторе производим необходимые расчеты. В этом способе мы прибегли к некоторому элементу автоматизации – калькулятор снял с нас задачу что-либо считать вручную, но при изменении любого слагаемого придется пересчитывать все заново. Конечно, не вручную, но какое-то время это займет.
3. Третий способ – написать небольшой код, который считает все самостоятельно. 
    + В этом способе нам необходимо записать все значения в переменные и задать формулу расчета. При любых изменениях достаточно всего лишь поменять соответствующие цифры и запустить код, что минимизирует время на любой перерасчет. Если перед вами стоит опция сравнения нескольких локаций для отпуска, то это идеальный вариант, потому что время на расчеты и изменения здесь минимальное. Вам лишь нужно будет потратить немного времени на то, чтобы написать сам код. А если вы достаточно хорошо умеете программировать, можно научить ваш код отслеживать изменения цен в режиме реального времени. В таком случае вы получите выгоду не только во времени, но уже и в деньгах. Неплохо, правда?  

**Давайте начнем наш путь в изучении Python!**

![05](/Data_Marathon/img/05_02.png)

Как мы говорили на предыдущем уроке, для работы с данными в языках программирования используются переменные. Мы можем упрощенно рассматривать переменные как некие контейнеры или ячейки, в которые можно сложить информацию. Эта информация может быть строкой текста, числом или иметь более сложный тип (об этом поговорим на пару степов позже). В Python переменные создаются в момент присваивания (приравнивания) им какого-либо значения.

Чтобы создать переменную, необходимо придумать ей имя и задать значение с помощью знака равно. К примеру, `value = 5`. Это называется «объявить» переменную. 

Необходимо учитывать, что при объявлении переменных регистр имеет значение. То есть `Value = 5` – уже совсем другая переменная, даже несмотря на то, что в ней лежит та же цифра. Давайте проверим это.

Скопируйте код ниже и проверьте результат. 

```python
value = 5
Value = 1
print(value, Value)
```

Имена переменных в Python могут содержать буквы, цифры и знак подчеркивания и не должны начинаться с цифры. Добавим, что переменным лучше давать «говорящие» имена, то есть такие, которые сразу дают понять, что за значение хранится в переменной. 

Для просмотра вывода программы нажмите «Запустить код».

![05](/Data_Marathon/img/05_03.png)

В Python существуют свои типы данных, давайте рассмотрим некоторые из них: 

1. `Integer` – целые числа <br>
Объявляется как `num_variable = 5`
2. `Float` – дробные числа <br>
Объявляется как  `float_variable = 2.5`
3. `String` – строки (последовательность символов)<br>
Объявляется как `string_variable = '5'
`
Значение всегда пишется в кавычках (одинарных или двойных)
Чтобы проверить, какого типа данных та или иная переменная, можно использовать функцию `type()`.

![05](/Data_Marathon/img/05_04.png)

Попробуйте запустить пример ниже: 

```python
num_variable = 5
print(type(num_variable))
```

Это вернет Вам значение `<class 'int'>` , в кавычках как раз указан тип данных.<br>
`int` расшифровывается как **integer**.

Для просмотра вывода программы нажмите «Запустить код».

В прошлом степе мы научились проверять тип данных переменных. Теперь давайте более подробно разберемся с функцией `print()`, которую мы уже использовали ранее.

Попробуйте запустить код ниже!

```python
num_variable = 5
print(num_variable, type(num_variable))
```

В этом примере показано, что в функцию `print()` может принимать на вход несколько аргументов*, их необходимо перечислить через запятую для последовательного вывода. Таким образом, в примере мы выводим сначала переменную `num_variable`, а затем ее тип данных.

>**Аргументы функции** — значения, которые заданная функция обрабатывает. Аргументы функции пишутся в круглых скобках после функции.

Для просмотра вывода программы нажмите «Запустить код».

На прошлом шаге вы вывели переменную и её тип данных.

```python
print(num_variable, type(num_variable))
```

При перечислении значений в `print()` они выведутся через пробел:

```
5 <class 'int'>
```

А теперь посмотрите, как будет выглядеть вывод, если мы используем две функции `print()`. Скопируйте код ниже и запустите его:

```python
num_variable = 5
print(num_variable)
print(type(num_variable))
```

Данные отобразятся на разных строках. Функция `print()` в конце имеет перенос строки, из-за этого следующий вывод (для `type(num_variable)`) начинается уже со следующей строки.

Мы узнали, что такое переменные, и познакомились с основными типами данных в Python. Пришло время научиться операциям, которые можно совершать над переменными.
С данными в Python можно проводить математические операции. Давайте начнем с простого и посчитаем сумму двух чисел.

Скопируйте код в поле ниже и нажмите «Отправить»:

```python
a = 3
b = 4
print(a + b)
```

А теперь по аналогии с предыдущим заданием перемножьте числа 3 и 4.

```python
a = 3
b = 4
print(a * b)
```

В программе можно выполнять несколько математических операций подряд. При этом порядок математических операций ровно такой же, как на уроках математики в школе: 

![05](/Data_Marathon/img/05_05.png)

Скобки позволяют явным образом указать последовательность вычислений, например, (3+4)*2
Действия в скобках будут произведены первыми, только затем программа выполнит операцию умножения.

Скопируйте код в поле ниже и нажмите «Отправить»:

```python
a = 3
b = 4
print((a + b)*2)
```

Перейдем к операторам сравнения. В Python их несколько:

![05](/Data_Marathon/img/05_06.png)

Давайте посмотрим, какой результат выдаст программа, если мы сравним два числа.

Скопируйте код в поле ниже и нажмите «Отправить»:

```python
a = 11
b = 5
print(a > b)
```

> В отличии от SQL в питоне сравнение на равенство пишется как «==», так как знак «=»  необходим для объявления переменной.

Всё верно, в Python есть еще один тип данных – логический тип данных `bool`, который имеет всего два значения: `True` (истина) и `False` (ложь). В нашем случае программа выдала `True`, так как 11 действительно больше 5.

![05](/Data_Marathon/img/05_07.png)

Скопируй код, который мы использовали в предыдущем шаге и поменяй знак на '=='. В результате получится `False`, так как тогда наше равенство будет читаться как '11 равно 5', а это неправда.

```python
a = 11
b = 5
print(a > b)
```

```python
a = 11
b = 5
print(a == b)
```

<hr>

[Содержание](#содержание)

# 5.2 Задача: планирование бюджета командировки

Вернемся к нашему примеру с планированием бюджета и попробуем применить то, что узнали, на простом примере.

![05](/Data_Marathon/img/05_08.png)

**Дано:**
+ Стоимость одного билета на самолет — 13 400 рублей 
+ Количество пассажиров — двое 
+ Аренда двухместного номера в отеле — 2 100 рублей/ночь
+ Количество ночей в отеле — 6
+ Аренда автомобиля в сутки — 4 500 рублей
+ Планируемое количество дней аренды автомобиля — 3 

Давайте напишем код, чтобы посчитать сколько всего нам необходимо денег, чтобы забронировать билеты, отель и автомобиль в грядущем путешествии! 

В первую очередь необходимо объявить все переменные: 

```python
avia_ticket_price = 13400
avia_pass_qnt = 2
hotel_night_price = 2100
hotel_night_qnt = 6
car_rent_daily_price = 4500
car_rent_days_qnt = 3
```

После того, как переменные объявлены, остается только посчитать итоговую стоимость. Для этого перемножим соответствующие переменные и сложим результаты:

```python
print(avia_ticket_price * avia_pass_qnt + hotel_night_price * hotel_night_qnt + car_rent_daily_price * car_rent_days_qnt)
```

Попробуйте совместить две части кода и запустить!

Поздравляем! У нас получилось решить первую прикладную задачу с помощью Python.
Теперь давайте попробуем сделать код чуть более красивым и понятным. Для этого нам необходимо вынести формулу расчета в отдельную переменную. 

Напомним как выглядит формула расчета сейчас:

```python
print(avia_ticket_price * avia_pass_qnt + hotel_night_price * hotel_night_qnt + car_rent_daily_price * car_rent_days_qnt)
```

Дело в том, что при объявлении переменной мы можем ссылаться так же и на другую переменную. Как и все в Python это делается достаточно просто: 

```python
avia_ticket_price = 13400
avia_pass_qnt = 2
hotel_night_price = 2100
hotel_night_qnt = 6
car_rent_daily_price = 4500
car_rent_days_qnt = 3

final_price = avia_ticket_price * avia_pass_qnt + hotel_night_price * hotel_night_qnt + car_rent_daily_price * car_rent_days_qnt
```

Мы перенесли формулу подсчета в переменную `final_price` , теперь, когда мы захотим вывести на экран итоговую стоимость мы можем просто написать `print(final_price)`, что читается намного проще и понятнее. Попробуйте вывести на экран итоговую стоимость поездки, но теперь уже новым методом.

Отлично, на предыдущем степе мы сделали код более читаемым. Теперь давайте ответим на вопрос: для чего именно делать код более читаемым? Может показаться, что мы просто перенесли формулу из одного места в другое и это ненужная работа, но это совсем не так. Давайте рассмотрим следующую задачу: необходимо вывести на экран итоговую стоимость поездки и стоимость поездки для одного человека. Другими словами разделить итоговую стоимость на количество людей, отправляющихся в путешествие. 

Если бы мы считали итоговую стоимость так, как делали это вначале, то код выглядел бы следующим образом: 

```python
print ('Итоговая стоимость путешествия =', avia_ticket_price * avia_pass_qnt + hotel_night_price * hotel_night_qnt + car_rent_daily_price * car_rent_days_qnt)
print ('Стоимость путешествия для одного человека =', (avia_ticket_price * avia_pass_qnt + hotel_night_price * hotel_night_qnt + car_rent_daily_price * car_rent_days_qnt)/avia_pass_qnt)
```

Проблем у этого варианта две: 

+ Это очень тяжело прочитать человеку, который видит этот код впервые. Строка вывода слишком длинная, при любом добавлении новых переменных легко запутаться. 
+ Фактически мы дважды заставляем машину считать одно и то же (финальную стоимость) в двух разных местах, что является лишней тратой как времени, так и ресурсов, которые компьютер использует для вычислений.

В случае, когда мы решаем эту задачу с помощью переменной `final_price` код выглядел бы так:

```python
print ('Итоговая стоимость путешествия =', final_price)
print ('Стоимость путешествия для одного человека =', final_price/avia_pass_qnt)
```

Согласитесь, что даже не видя остальную часть кода по этим функциям вывода уже примерно понятно, что происходит. Таким образом у нас получается решить сразу обе проблемы, описанные выше.

А теперь получите итоговую стоимость путешествия и стоимость путешествия для одного человека (скопируйте код выше). Не забудьте объявить переменные:

```python
avia_ticket_price = 13400
avia_pass_qnt = 2
hotel_night_price = 2100
hotel_night_qnt = 6
car_rent_daily_price = 4500
car_rent_days_qnt = 3

final_price = avia_ticket_price * avia_pass_qnt + hotel_night_price * hotel_night_qnt + car_rent_daily_price * car_rent_days_qnt
```

![05](/Data_Marathon/img/05_09.png)

Вы отлично продвигаетесь по курсу и уже многого достигли! Мы познакомились с базовыми возможностями Python и даже рассчитали бюджет для командировки.

Настало время погрузиться немного глубже в другие особенности языка. В следующем уроке вы познакомитесь с библиотекой pandas(расширенным функционалом языка Python). Не переживайте, если тема pandas покажется вам сложной. Она действительно сложнее предыдущих тем. Мы же со своей стороны постарались упростить материал, чтобы не углубляться в технические особенности и термины.

Вы уже почти достигли звания «Лучший стажер»! Так что не останавливайтесь – осталось совсем немного!

<hr>

[Содержание](#содержание)

# 5.3 Pandas: фильтрация данных

В первом степе вводного урока по Python мы выделяли два ключевых преимущества этого языка программирования перед остальными: простота и легкость синтаксиса, а также множество бесплатных библиотек. 

Так что же такое эти библиотеки и зачем они нужны? Давайте рассмотрим пример из жизни. Когда-то очень-очень давно люди решили упростить себе жизнь и придумали счеты для того, чтобы не считать все вручную (производить операции быстрее) и, возможно, меньше ошибаться в расчетах. Для того, чтобы уметь производить вычисления на счетах необходимы были специальные навыки/знания того, как эти самые счеты устроены и как получить результат.

Перенесемся чуть ближе к нашему времени. Совсем недавно, в середине 20-го века люди смогли упростить себе жизнь еще больше, и на свет появился калькулятор. Он не требовал никаких специальных навыков, потому что в нем было все просто и понятно. Калькулятор требовал минимальных знаний для того, чтобы с ним можно было работать, и существенно ускорял вычисления. 

Вскоре стало понятно, что обычных операций на калькуляторе не хватает для полноценной работы, к примеру, инженеров. Как посчитать квадратный корень числа 5329? Очевидно, что было бы существенно легче, если бы на калькуляторе была одна кнопка, которая делает это за человека. Спрос рождает предложение, и так появились инженерные калькуляторы. В них, помимо базовых функций калькулятора, были доступны и многие другие: посчитать синус, квадратный корень, логарифм и т.д., которые в разы ускоряли уже сложные расчеты. 

![05](/Data_Marathon/img/05_10.png)

По такому же принципу появилась и концепция библиотек в языках программирования. Это дополнения, которые созданы для того, чтобы ускорить разработку и упростить разработчикам жизнь. Как? Аналогично с инженерными калькуляторами – в библиотеках множество готовых функций, которые не идут «из коробки», но они написаны кем-то за вас. Можно просто брать и пользоваться.

В этом модуле мы познакомимся с одной из самых часто используемых библиотек для анализа данных на Python — `pandas`

С помощью Python Вы научились выводить сообщения на экран, производить математические операции над числами и узнали об основных типах данных. Пришло время познакомиться с `pandas`. 

![05](/Data_Marathon/img/05_11.png)

Чтобы использовать библиотеки, нужно их импортировать (подключить), для этого в начале программы пишется такой код:

```python
import pandas as pd
```

Вот так просто! Теперь нам будет доступно всё, что есть внутри этой библиотеки. 

Давайте разберемся как это работает. Код выше состоит из двух частей: 

`import pandas` — именно так мы подключаем библиотеку `pandas`, и теперь можно пользоваться всеми возможностями, которые она предоставляет. 
`as pd` — между собой разработчики договорились, что будут использовать для библиотеки `pandas` сокращенное имя при работе. После слова  `as`  и задается дополнительное имя для библиотеки, которое будет использоваться далее в коде. Это просто для удобства, задавать новое имя необязательно.

Множество действий над данными, которые мы совершаем в SQL, мы так же можем реализовать в Python с помощью библиотеки `pandas` .

Для того, чтобы произвести какие-нибудь действия с данными в таблице, ее для начала надо задать/объявить (аналогично оператору `FROM` в `SQL`). В Python  "из коробки" нет ни таблиц, ни механизмов* их обработки, именно тут `pandas`  приходит нам на помощь. Разработчики создали специальный тип данных, который называется `DataFrame`, и он подобен таблицам в привычном понимании. В нем есть и строки, и столбцы. 

К этому типу данных в дополнение идет множество функций, которые позволяют обрабатывать данные как в SQL, а зачастую даже с более расширенными возможностями. 

Из-за особенностей работы платформы Stepik мы создали переменную `df` за вас, вы можете ее использовать в качестве источника данных. `df`  имеет тип данных `DataFrame` . 

Давайте сперва научимся считывать данные, которые лежат в переменной `df`.  Для этого необходимо импортировать библиотеку  `pandas` и создать новую переменную, в которую сохраним данные из `df` . Новую переменную назовем `my_df`. 

Для просмотра датафрейма добавьте в программу строку `print(my_df)` и нажмите «Запустить код».  Здесь вы можете подробнее прочитать, как работать с такими заданиями.

>*Под механизмами обработки подразумеваются функции аналогичные `sum()`, `max()` и прочим в `SQL`

```python
import pandas as pd
my_df = df
print(my_df)
```

Теперь, когда мы научились считывать данные из переменной `df`, давайте попробуем вывести только один столбец.

Для этого в квадратных скобках нужно указать название столбца, данные которого мы хотим получить, например, **df['type']**. Если пробовать перевести это на человеческий язык, то получится "Из df покажи нам столбец type" 

В отличии от функций , здесь мы используем квадратные скобки, потому что хотим обратиться к какой-то конкретной части таблицы. 'type' указываем в кавычках, так как это конкретное название столбца, который мы хотим получить.

В переменную `df_column_type` сохраните данные из столбца 'type' датафрейма `df`, по аналогии как показано выше.

Для просмотра вывода программы добавьте в программу строку `print(df_column_type)` и нажмите «Запустить код».

```python
import pandas as pd
df_column_type = df['type']
print(df_column_type)
```

![05](/Data_Marathon/img/05_12.png)

Отлично! Так держать! Давайте вернемся к уже знакомой нам таблице `game_events` и попробуем вывести колонку `user_id`(идентификаторы игроков). Попробуем сделать это немного иначе. 

Что же произойдет, если написать название столбца без кавычек? Python будет считать, что вы передаете ему переменную. В нее нужно заранее сохранить название столбца, например, `column_name = 'user_id'`.  Соответственно, когда вы будете выводить столбец `game_events[column_name]`, Python найдет переменную `column_name` и «заберет» из нее сохраненное значение, в нашем случае '`user_id`', и таким образом поймет, какой столбец нужно вывести. Давайте попробуем!  

Для этого сначала объявите переменную `column_name = 'user_id'` . Так, в `column_name` мы сохраняем нужное нам значение, чтобы затем его использовать для вывода конкретного столбца.

А теперь в переменную `game_events_users` сохраните данные столбца `column_name` из датафрейма `game_events`.

В этом степе мы создали `DataFrame` `game_events`, в котором лежат данные. Далее будем работать так же с ним.

Для просмотра вывода программы добавьте в программу строку `print(game_events_users)` и нажмите «Запустить код».

```python
import pandas as pd
column_name = 'user_id'
game_events_users = game_events[column_name]
print(game_events_users)
```

На прошлом шаге вы получили список игроков, но в нем много дублирующих значений, что не очень удобно для просмотра. Чтобы получить уникальные идентификаторы игроков к данным нужно применить метод* `unique()`, который выделит только уникальные записи (аналог `DISTINCT` в SQL). Как это делается? 

`unique()` — это специальный метод, который можно применить к объектам с типом `DataFrame`. Синтаксически это выглядит следующим образом: `game_events['user_id'].unique()`. То есть сначала указываем объект (в нашем случае выбираем конкретный столбец, из которого хотим получить уникальные значения), к которому необходимо применить метод, потом точку, а затем название самого метода. Круглые скобки оставляем пустыми, так как нам не нужно ничего передавать внутрь метода, а лишь применить его на существующих данных.

Соответственно, решение задачи выше будет следующим:

```python
import pandas as pd
game_events_unique_users = game_events['user_id'].unique()
print(game_events_unique_users)
```

Скопируйте код программы выше и запустите ее.

> Метод — функция, которая работает только с определенным типом данных.

В отличие от SQL в Python есть метод, который сразу подсчитывает количество уникальных значений в столбце — `nunique()`.

Скопируйте код ниже, заменив `unique()` на `nunique()` и запустите его:

```python
game_events_unique_users = game_events['user_id'].unique()
print(game_events_unique_users)
```

```python
import pandas as pd
game_events_unique_users = game_events['user_id'].nunique()
print(game_events_unique_users)
```

Теперь давайте познакомимся с фильтрацией данных в pandas (аналог `WHERE` в SQL). Попробуем найти все данные по событию `app_first_launch`. 

Скопируйте код программы ниже и запустите ее. Не пугайтесь в следующем шаге мы расшифруем, как читать этот код.

```python
import pandas as pd
my_game_events = game_events[game_events['event_name'] == 'app_first_launch']
print(my_game_events)
```

На прошлом шаге мы отфильтровали данные и получили следующую строку:

![05](/Data_Marathon/img/05_13.png)

Давайте более детально разберемся как это работает.

![05](/Data_Marathon/img/05_14.png)

Код выше можно прочитать так: в переменную `my_game_events` сохраняем данные из датафрейма, где значения в колонке `game_events['event_name']` соответствуют 'app_first_launch' 

По аналогии можно, например, так отфильтровать данные:
1) по дате: `game_events[game_events['event_date'] == '2021-01-10']` - получаем все строки, где дата события '2021-01-10'
2) по названию уровня: `game_events[game_events['level_name'] == 'level_03']` - получаем все строки, где название уровня 'level_03'
3) по стоимости внутриигровой покупки: `game_events[game_events['revenue'] > 2]` - получаем все строки, где выручка больше двух.

Выберите только те строки, где идентификатор пользователя `f5ef9841`.

В переменную `my_game_events` сохраните отфильтрованные данные из датафрейма `game_events`, где  user_id равен 'f5ef9841'.

```python
import pandas as pd
my_game_events = game_events[game_events['user_id'] == 'f5ef9841']
```

Выберите только те строки, где игровые события произошли после 14 января 2021 года.

В переменную `my_game_events` сохраните отфильтрованные данные из датафрейма `game_events`, где  `event_date` больше '2021-01-14'.

```python
import pandas as pd
my_game_events = game_events[game_events['event_date'] > '2021-01-14']
```

Выберите только те строки, где внутриигровые покупки пользователей больше или равны числу 7.49.

В переменную `my_game_events` сохраните отфильтрованные данные из датафрейма `game_events`, где `revenue` больше или равен числу 7.49.

```python
import pandas as pd
my_game_events = game_events[game_events['revenue'] >= 7.49]
```

<hr>

[Содержание](#содержание)

# 5.4 Pandas: агрегация данных

Вы познакомились с фильтрацией данных в pandas. Пришло время для агрегирующих методов для DataFrame. Давайте познакомимся с основными:

1) `count()` - считает количество значений (не берет в расчет пустые значения)
2) `sum()` - вычисляет сумму значений
3) `max()` - выбирает максимальное значение
4) `min()` -  выбирает минимальное значение
5) `mean()` - считает среднее
6) `median()` - считает медиану

Если применить, например, функцию `count()` ко всему датафрейму: `game_events.count()`, то мы получим количество значений по каждому столбцу. Как и в SQL, функция `count()` не считает пустые значения.

![05](/Data_Marathon/img/05_15.png)

Агрегирующие функции можно также применять и к отдельным столбцам. Например, с помощью программы ниже можно найти максимальное значение внутриигровой покупки: `game_events['revenue'].max()`.

![05](/Data_Marathon/img/05_16.png)

Итак, в этой задаче нужно посчитать значение и сохранить результат в переменную:

В переменную `sum_revenue` сохраните сумму всех внутриигровых покупок (`revenue`). 

```python
import pandas as pd
sum_revenue = game_events['revenue'].sum()
```

Посчитайте два значения, сохраните результаты в две переменные и выведите их:

+ В переменную max_date сохраните максимальную дату игрового события (event_date);
+ В переменную min_date сохраните минимальную дату игрового события (event_date). 
Для просмотра вывода программы добавьте в программу строку print(max_date, min_date) и нажмите «Запустить код».

```python
import pandas as pd
max_date = game_events['event_date'].max()
min_date = game_events['event_date'].min()
print(max_date, min_date)
```

Посчитайте два значения, сохраните результаты в две переменные и выведите их:

+ В переменную mean_revenue сохраните среднее значение внутриигровых покупок (revenue);
+ В переменную median_revenue сохраните медианное значение внутриигровых покупок (revenue). 

Для просмотра вывода программы добавьте в программу строку print(mean_revenue, median_revenue) и нажмите «Запустить код».

```python
import pandas as pd
mean_revenue = game_events['revenue'].mean()
median_revenue = game_events['revenue'].median()
print(mean_revenue, median_revenue)
```

Как и в SQL, в Python можно агрегировать отфильтрованные данные.

Давайте посчитаем количество внутриигровых событий (`event_name`) для пользователя 'f5ef9841'.
Скопируйте код ниже и запустите его.

```python
import pandas as pd
count_events = game_events[game_events['user_id'] == 'f5ef9841']['event_name'].count()
print(count_events)
```

Давайте разберемся, как прочитать код из предыдущего задания.

Полностью код выглядит так:

```python
count_events = game_events[game_events['user_id'] == 'f5ef9841']['event_name'].count()
```

В первой части `game_events[game_events['user_id'] == 'f5ef9841']` мы отфильтровываем данные по пользователю 'f5ef9841'. Более подробно фильтрацию данных мы рассматривали здесь. 

После того как мы отфильтровали данные, мы получили `DataFrame`, в котором нужно посчитать количество записей по столбцу 'event_name'. Это мы делаем уже во второй части кода: `['event_name'].count()` то есть сначала указываем столбец, который необходимо вывести, а потом применяем к нему метод, считающий количество строк. 

Посчитайте количество внутриигровых событий за 15 января 2021 года.
Для этого в переменную `count_events` сохраните количество внутриигровых событий (`event_name`) за '2021-01-15'.

Для просмотра вывода программы добавьте в программу строку `print(count_events)` и нажмите «Запустить код».

```python
import pandas as pd
count_events = game_events[game_events['event_date'] == '2021-01-15']['event_name'].count()
print(count_events)
```

<hr>

[Содержание](#содержание)