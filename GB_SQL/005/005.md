# SQL ‚Äì –æ–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

# –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

[–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∫—É—Ä—Å–∞](/GB_SQL/README.md)

# –¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è

***–û–∫–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤ SQL -** —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º —Å—Ç—Ä–æ–∫ (–æ–∫–Ω–æ–º, –ø–∞—Ä—Ç–∏—Ü–∏–µ–π) –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –¥–ª—è —ç—Ç–æ–≥–æ –Ω–∞–±–æ—Ä–∞ —Å—Ç—Ä–æ–∫ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Å—Ç–æ–ª–±—Ü–µ.*

***–ü–∞—Ä—Ç–∏—Ü–∏–∏ (–æ–∫–Ω–∞ –∏–∑ –Ω–∞–±–æ—Ä–∞ —Å—Ç—Ä–æ–∫) -** —ç—Ç–æ –Ω–∞–±–æ—Ä —Å—Ç—Ä–æ–∫, —É–∫–∞–∑–∞–Ω–Ω—ã–π –¥–ª—è –æ–∫–æ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ –æ–¥–Ω–æ–º—É –∏–∑ —Å—Ç–æ–ª–±—Ü–æ–≤ –∏–ª–∏ –≥—Ä—É–ø–ø–µ —Å—Ç–æ–ª–±—Ü–æ–≤ —Ç–∞–±–ª–∏—Ü—ã. –ü–∞—Ä—Ç–∏—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –æ–∫–æ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –∑–∞–ø—Ä–æ—Å–µ –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –ø–æ —Ä–∞–∑–ª–∏—á–Ω—ã–º –∫–æ–ª–æ–Ω–∫–∞–º —Ç–∞–±–ª–∏—Ü—ã.*

***–ê–≥—Ä–µ–≥–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–∞–≥—Ä–µ–≥–∞—Ü–∏–∏) ‚Äî** —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –æ—Ç –≥—Ä—É–ø–ø—ã –∑–Ω–∞—á–µ–Ω–∏–π –∏ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç –∏—Ö –≤ –æ–¥–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–µ–µ.*

***–§—É–Ω–∫—Ü–∏–∏ —Å–º–µ—â–µ–Ω–∏—è** ‚Äì —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç –ø–µ—Ä–µ–º–µ—â–∞—Ç—å—Å—è –∏ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ —Ä–∞–∑–Ω—ã–º —Å—Ç—Ä–æ–∫–∞–º –≤ –æ–∫–Ω–µ, –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–æ–∫–∏, –∞ —Ç–∞–∫–∂–µ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –≤ –Ω–∞—á–∞–ª–µ –∏–ª–∏ –≤ –∫–æ–Ω—Ü–µ –æ–∫–Ω–∞.*

***–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏** ‚Äî —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ –∫–æ—Ç–æ—Ä—ã–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.*

***–ü—Ä–µ–¥–∏–∫–∞—Ç –≤ SQL —ç—Ç–æ:***

 *****–≤ —à–∏—Ä–æ–∫–æ–º —Å–º—ã—Å–ª–µ, ‚Äî –ª—é–±–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ, —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –∫–æ—Ç–æ—Ä–æ–≥–æ —è–≤–ª—è—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è –±—É–ª–µ–≤–æ–≥–æ —Ç–∏–ø–∞ ‚Äî TRUE, FALSE, –∞ —Ç–∞–∫ –∂–µ UNKNOWN*

*–≤ —É–∑–∫–æ–º —Å–º—ã—Å–ª–µ, ‚Äî –Ω–µ–∫–∏–π —É—Ç–æ—á–Ω—è—é—â–∏–π —Ñ–∏–ª—å—Ç—Ä. –°–∞–º—ã–º —è–≤–Ω—ã–º –ø—Ä–∏–º–µ—Ä–æ–º –ø—Ä–µ–¥–∏–∫–∞—Ç–∞ —Å–ª—É–∂–∏—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä WHERE*

<hr>

[–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](#—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)

–î–æ–±—Ä–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫, —É–≤–∞–∂–∞–µ–º—ã–µ —Å—Ç—É–¥–µ–Ω—Ç—ã!

–ù–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π –ª–µ–∫—Ü–∏–∏ –æ—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ —Ö–æ—Ç–µ–ª–æ—Å—å –±—ã —É–¥–µ–ª–∏—Ç—å –º–æ—â–Ω–æ–º—É –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ - –æ–∫–æ–Ω–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º. ‚Äú–û–∫–æ—à–∫–∏‚Äù –ø–æ–º–æ–≥–∞—é—Ç –¥–µ–ª–∞—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç—á–µ—Ç—ã –±–µ–∑ —É—á–∞—Å—Ç–∏—è —Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ –ü–û (‚Äù—ç–∫—Å–µ–ª—è‚Äù). 

–î–∞–≤–∞–π—Ç–µ –ø–æ–ø—Ä–æ–±—É–µ–º —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é –º–∞—Å—Å—É –∑–∞–¥–∞—á, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —Ä–µ—à–∞—Ç—å –æ–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∑–∞—Ç–µ–º - —Ä–∞–∑–±–µ—Ä–µ–º—Å—è, –∫–∞–∫ –∂–µ –≤–æ–ø–ª–æ—Ç–∏—Ç—å –Ω–∞—à–∏ –æ–∂–∏–¥–∞–Ω–∏—è —Å –ø–æ–º–æ—â—å—é –∫–æ–¥–∞:

- –†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ. –°–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ä–µ–π—Ç–∏–Ω–≥–æ–≤: —Ç–æ–ø-100 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤ –Ω–∞ –∫–∞–∫–æ–π-—Ç–æ —Ä–∞–¥–∏–æ—Å—Ç–∞–Ω—Ü–∏–∏
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞–∑–Ω–∏—Ü—ã –º–µ–∂–¥—É –±–ª–∏–∑–∫–∏–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ (2 –∏ 3 —á–µ–ª–æ–≤–µ–∫ –≤ —Ç–æ–ø-5 —Å–∞–º—ã—Ö –±–æ–≥–∞—Ç—ã—Ö –ª—é–¥–µ–π –º–∏—Ä–∞)
- ‚Äú–°–∫–æ–ª—å–∑—è—â–∏–µ‚Äù –∞–≥—Ä–µ–≥–∞—Ç—ã
- –ê–≥—Ä–µ–≥–∞—Ü–∏—è (—Ç–æ–ø —Å–∞–º—ã—Ö –≤—ã—Å–æ–∫–∏—Ö –∑–∞—Ä–ø–ª–∞—Ç)

<hr>

[–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](#—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)

# **–ö–ª–∞—Å—Å—ã –æ–∫–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π**

–ú–Ω–æ–∂–µ—Å—Ç–≤–æ –æ–∫–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –º–æ–∂–Ω–æ –ø–æ–¥–µ–ª–∏—Ç—å –Ω–∞ 3 –≥—Ä—É–ø–ø—ã:

- –ê–≥—Ä–µ–≥–∏—Ä—É—é—â–∏–µ (Aggregate)
- –†–∞–Ω–∂–∏—Ä—É—é—â–∏–µ (Ranking)
- –§—É–Ω–∫—Ü–∏–∏ —Å–º–µ—â–µ–Ω–∏—è (Value)
- –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏.

**–°–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ –ø–æ –ó–ü**

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
CREATE TABLE IF NOT EXISTS staff 
(
    id INT PRIMARY KEY,
    first_name VARCHAR(30),
    post VARCHAR(30),
    discipline VARCHAR(30),
    salary INT
);

-- –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –¥–∞–Ω–Ω—ã–º–∏
INSERT staff (id, first_name, post, discipline, salary)
VALUES
	(100,'–ê–Ω—Ç–æ–Ω', '–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å', '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ', 50),
	(101,'–í–∞—Å–∏–ª–∏–π', '–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å', '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ', 60),
	(103,'–ê–ª–µ–∫—Å–∞–Ω–¥—Ä', '–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç', '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ', 25),
	(104,'–í–ª–∞–¥–∏–º–∏—Ä', '–ü—Ä–æ—Ñ–µ—Å—Å–æ—Ä', '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', 120),
	(105,'–ò–≤–∞–Ω', '–ü—Ä–æ—Ñ–µ—Å—Å–æ—Ä', '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', 120),
	(106,'–ú–∏—Ö–∞–∏–ª', '–î–æ—Ü–µ–Ω—Ç', '–§–∏–∑–∏–∫–∞', 70),
	(107, '–ê–Ω–Ω–∞', '–î–æ—Ü–µ–Ω—Ç', '–§–∏–∑–∏–∫–∞', 70),
	(108, '–í–µ—Ä–æ–Ω–∏–∫–∞', '–î–æ—Ü–µ–Ω—Ç', '–ò–ö–¢', 30),
	(109,'–ì—Ä–∏–≥–æ—Ä–∏–π', '–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å', '–ò–ö–¢', 25),
	(110,'–ì–µ–æ—Ä–≥–∏–π', '–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç', '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ', 30);
```

![05](/GB_SQL/img/05_01.png)

–ö–∞–∫ –º—ã –≤–∏–¥–∏–º, –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–∞–Ω–≥ –±—É–¥–µ—Ç —É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π –ó–ü (–¥–æ–ø—É—Å—Ç–∏, –í–ª–∞–¥–∏–º–∏—Ä –∏ –ò–≤–∞–Ω –≤ –ø—Ä–∞–≤–æ–π —Ç–∞–±–ª–∏—Ü–µ, –ò–≤–∞–Ω –∏ –ú–∏—Ö–∞–∏–ª, –í–µ—Ä–æ–Ω–∏–∫–∞ –∏ –ì–µ–æ—Ä–≥–∏–π).

![05](/GB_SQL/img/05_02.png)

–î–∞–≤–∞–π—Ç–µ –ø–æ–ø—Ä–æ–±—É–µ–º –ø—Ä–æ–π—Ç–∏—Å—å –ø–æ –≤—Å–µ–º —Å—Ç—Ä–æ—á–∫–∞–º  –ù–∞—á–Ω–µ–º —Å 1 –∏ –±—É–¥–µ–º –ø—Ä–æ—Å—Ç–∞–≤–ª—è—Ç—å —Ä–∞–Ω–≥. –î–ª—è –ø—Ä–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä–∞–Ω–≥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—á–∏—Ç—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞ - `salary`. –í –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –æ–∫–æ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ - –æ–∫–Ω–æ. –ü—Ä–∏ –æ–±—ã—á–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ –≤—Å–µ –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –µ–¥–∏–Ω—ã–º –ø–æ—Ç–æ–∫–æ–º, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ —Å—á–∏—Ç–∞—é—Ç—Å—è –∞–≥—Ä–µ–≥–∞—Ç—ã. –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –æ–∫–æ–Ω–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –Ω–∞—à –∑–∞–ø—Ä–æ—Å –¥–µ–ª–∏—Ç—Å—è –Ω–∞ –Ω–µ–±–æ–ª—å—à–∏–µ —á–∞—Å—Ç–∏  (–æ–∫–Ω–∞) –∏ —É–∂–µ –¥–ª—è –∫–∞–∂–¥–æ–π –∏–∑ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —á–∞—Å—Ç–µ–π —Å—á–∏—Ç–∞—é—Ç—Å—è —Å–≤–æ–∏ –∞–≥—Ä–µ–≥–∞—Ç—ã.

![05](/GB_SQL/img/05_03.png)

–ü—Ä–∏–º–µ—Ä –¥–ª—è –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã:

![05](/GB_SQL/img/05_04.png)

–ù–∞—à–µ –æ–∫–Ω–æ  - —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—Ç–æ–ª–±—Ü–∞ salary, –∫–æ—Ç–æ—Ä–æ–µ –º—ã –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª–∏ –ø–æ —É–±—ã–≤–∞–Ω–∏—é.

**–ö–∞–∫ –∂–µ –∑–∞–ø–∏—Å–∞—Ç—å —ç—Ç–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ SQL?**

–î–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è `OVER`:

```sql
SELECT –ù–∞–∑–≤–∞–Ω–∏–µ_—Ñ—É–Ω–∫—Ü–∏–∏ (—Å—Ç–æ–ª–±–µ—Ü –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π) 
OVER 
(
      PARTITION BY —Å—Ç–æ–ª–±–µ—Ü –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
      ORDER BY —Å—Ç–æ–ª–±–µ—Ü –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
      ROWS –∏–ª–∏ RANGE –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å—Ç—Ä–æ–∫ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –≥—Ä—É–ø–ø—ã
)
```

–ù–∞—à–µ–º—É –æ–∫–Ω—É –º–æ–∂–Ω–æ —Ç–∞–∫ –∂–µ –ø—Ä–∏—Å–≤–æ–∏—Ç—å –∏–º—è, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∑–∞–ø—Ä–æ—Å–µ.  –ù–∞—à–µ –æ–∫–Ω–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ—Å—Ç–∞–≤–ª—è—Ç—å —Ä–∞–Ω–≥ –ø–æ —É–±—ã–≤–∞–Ω–∏—é —Å—Ç–æ–ª–±—Ü–∞ `salary`:

```sql
WINDOW w AS (ORDER BY salary desc)
```

+ `window` ‚Äî –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–∫–Ω–∞;
+ `w` ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–∫–Ω–∞, —É–∫–∞–∑—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª, –∫–∞–∫ –∏ –ø—Å–µ–≤–¥–æ–Ω–∏–º –±–µ–∑ AS;
+ ORDER BY salary DESC ‚Äî —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Å—Ç–æ–ª–±—Ü–∞ `salary`.

–í–Ω—É—Ç—Ä–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –æ–∫–Ω–∞ –Ω—É–∂–Ω–æ –ø–æ—Å—á–∏—Ç–∞—Ç—å —Ä–∞–Ω–≥ (—Ä–∞–Ω–≥ –ø–æ –æ–∫–Ω—É w).

–ü—É—Å—Ç—å –∏–º–µ–µ—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞:

![05](/GB_SQL/img/05_05.png)

–ù–∞—á–Ω–µ–º —Å –ø—Ä–∏–º–µ—Ä–∞: –æ—Ç–∫—Ä–æ–µ–º –æ–∫–Ω–æ `over` –∏ –Ω–∞–π–¥–µ–º —Å—É–º–º—É –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∫—É–ø–æ–∫:

```sql
SELECT shopping_day, department, count,
	SUM(count) OVER() AS 'Sum',
	COUNT(count) OVER() AS 'Count' 
FROM shop;
```

![05](/GB_SQL/img/05_06.png)

–í –Ω–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ —Å—É–º–º–∞, —Ä–∞–≤–Ω–∞—è 29 - —ç—Ç–æ –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∫—É–ø–æ–∫(—Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ–≥–æ —Å—Ç–æ–ª–±—Ü–∞ `count` –∏ –ø–æ–¥—Å—á–µ—Ç –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç—Ä–æ–∫). –ï—Å–ª–∏ –±—ã –º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –∞–≥—Ä–µ–≥–∞—Ç–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –≤ —á–∏—Å—Ç–æ–º –≤–∏–¥–µ, —Ç–æ –ø–æ–ª—É—á–∏–º —Å—É–∂–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∫–∏ –¥–æ 1 —Å—Ç–æ—á–∫–∏. 

**–í –æ–∫–æ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å—Ö–æ–¥–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –Ω–µ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –∏—Å—Ö–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ–π. –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∞–≥—Ä–µ–≥–∏—Ä—É—é—â–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ GROUP BY —Å–æ–∫—Ä–∞—â–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –≤ –∑–∞–ø—Ä–æ—Å–µ —Å –ø–æ–º–æ—â—å—é –∏—Ö –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏.**

```sql
SELECT 
	SUM(count)  AS 'Sum', 
	COUNT(count) AS 'Count' 
FROM shop;
```

![05](/GB_SQL/img/05_07.png)

![05](/GB_SQL/img/05_08.png)

–í–Ω—É—Ç—Ä–∏ –æ–∫–Ω–∞ —Ç–∞–∫ –∂–µ –≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É.

- **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞**

–î–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è  `PARTITION BY` , –∫–æ—Ç–æ—Ä–∞—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç–æ–ª–±–µ—Ü –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –≤ –æ–∫–Ω–µ:

![05](/GB_SQL/img/05_09.png)

```sql
SELECT shopping_day, department, count,
	SUM(count) OVER(PARTITION BY shopping_day) AS 'Sum' 
FROM shop;
```

![05](/GB_SQL/img/05_10.png)

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è `PARTITION BY` —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–ª–∞ —Å—Ç—Ä–æ–∫–∏ –ø–æ –ø–æ–ª—é ¬´**shopping_day**¬ª–∏  –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Å—É–º–º–∞ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —Å—Ç–æ–ª–±—Ü—É ¬´**count**¬ª.

- **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞**

![05](/GB_SQL/img/05_11.png)

–î–æ–±–∞–≤–∏–º –∫ `PARTITION BY` —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –ø–æ —Å—Ç–æ–ª–±—Ü—É `¬´department¬ª` (`ORDER BY department`). –í –¥–∞–Ω–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ –º—ã –±—É–¥–µ–º —Å—á–∏—Ç–∞—Ç—å –Ω–∞—Ä–∞—Å—Ç–∞—é—â–∏–π –∏—Ç–æ–≥: –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è ¬´count¬ª –º—ã –∏—â–µ–º —Å—É–º–º—É –≤—Å–µ—Ö –∑–Ω–∞—á–µ–Ω–∏–π —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏.

```sql
SELECT shopping_day, department, count,
	SUM(count) OVER(PARTITION BY shopping_day ORDER BY department) AS 'Sum' 
FROM shop;
```

![05](/GB_SQL/img/05_12.png)

–ò –≤–∏—à–µ–Ω–∫–∞ –Ω–∞ —Ç–æ—Ä—Ç–∏–∫–µ - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ –≤ –æ–∫–Ω–µ :)

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è `rows` –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç —Å—Ç—Ä–æ–∫–∏ –≤ –æ–∫–Ω–µ, —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫, –ø—Ä–µ–¥—à–µ—Å—Ç–≤—É—é—â–∏—Ö –∏–ª–∏ —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞ —Ç–µ–∫—É—â–µ–π.

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è `range` , –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç `rows` , —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ —Å–æ —Å—Ç—Ä–æ–∫–∞–º–∏, –∞ —Å –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º —Å—Ç—Ä–æ–∫ –≤ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ ORDER BY. 

–û–±–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ `rows` –∏ `range` –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å ORDER BY.

![05](/GB_SQL/img/05_13.png)

- **`UNBOUNDED PRECEDING`**¬†‚Äì —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –æ–∫–Ω–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –≥—Ä—É–ø–ø—ã;
- **`n PRECEDING`**¬†‚Äì¬†**n** —Å—Ç—Ä–æ–∫ –ø–µ—Ä–µ–¥ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–æ–∫–æ–π.
- **`CURRENT ROW`**¬†‚Äì –æ–∫–Ω–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∏–ª–∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–æ–∫–µ;
- **`n FOLLOWING`**¬†‚Äì –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —á–∏—Å–ª–æ —Å—Ç—Ä–æ–∫ –ø–æ—Å–ª–µ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–æ–∫–∏ (–Ω–µ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏ RANGE). **n** —Å—Ç—Ä–æ–∫ –ø–æ—Å–ª–µ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–æ–∫–∏.
- **`UNBOUNDED FOLLOWING`**¬†‚Äì C –ø–æ–º–æ—â—å—é –¥–∞–Ω–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å, —á—Ç–æ –æ–∫–Ω–æ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–æ–∫–µ –≥—Ä—É–ø–ø—ã

–°—É–º–º–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ —Ç–µ–∫—É—â–µ–π –∏ —Å–ª–µ–¥—É—é—â–µ–π —è—á–µ–π–∫–µ –≤ –æ–∫–Ω–µ. –ê –ø–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–æ–∫–∞ –≤ –æ–∫–Ω–µ –∏–º–µ–µ—Ç —Ç–æ –∂–µ –∑–Ω–∞—á–µ–Ω–∏–µ, —á—Ç–æ –∏ —Å—Ç–æ–ª–±–µ—Ü ¬´count¬ª: –±–æ–ª—å—à–µ –Ω–µ —Å —á–µ–º —Å–∫–ª–∞–¥—ã–≤–∞—Ç—å.

```sql
SELECT shopping_day, department, count,
	SUM(count) OVER(PARTITION BY shopping_day ORDER BY count ROWS BETWEEN CURRENT ROW AND 1 FOLLOWING) AS 'Sum' 
FROM shop;
```

![05](/GB_SQL/img/05_14.png)

<hr>

[–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](#—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)

# –†–∞–Ω–∂–∏—Ä—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

–≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è —Ä–∞–Ω–≥–∞ –∏–ª–∏ –ø–æ—Ä—è–¥–∫–æ–≤–æ–≥–æ –Ω–æ–º–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π —É –Ω–∞—Å –Ω–∞ —Ä—É–∫–∞–≤–µ üôÇ

- `row_number`‚Äì –∑–∞–¥–∞–µ–º –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –Ω—É–º–µ—Ä–∞—Ü–∏–∏;
- `rank`‚Äî —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞–Ω–≥ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏, –≤ —Å–ª—É—á–∞–µ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–∞–Ω–≥ —Å –ø—Ä–æ–ø—É—Å–∫–æ–º —Å–ª–µ–¥—É—é—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è;
- `dense_rank`‚Äî —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–∞–∫ –∂–µ —Ä–∞–Ω–≥ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏. –ù–æ –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ `rank`, –æ–Ω–∞ –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞–Ω–≥, –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞—è —Å–ª–µ–¥—É—é—â–∏–π;
- `ntitle`‚Äì —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–¥–µ–ª–∏—Ç—å –≤–∞—à—É –≤—ã–±–æ—Ä–∫—É –Ω–∞ –≥—Ä—É–ø–ø—ã, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–ø–ø –∑–∞–¥–∞–µ—Ç—Å—è –≤ —Å–∫–æ–±–∫–∞—Ö.

–ü—Ä–∏–º–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã:

![05](/GB_SQL/img/05_15.png)

```sql
SELECT shopping_day, department, count,
	ROW_NUMBER() OVER(PARTITION BY shopping_day ORDER BY count) AS 'Row_number',
	RANK() OVER(PARTITION BY shopping_day ORDER BY count) AS 'Rank' ,
	DENSE_RANK() OVER(PARTITION BY shopping_day ORDER BY count) AS 'Dense_Rank' ,
	NTILE(3) OVER(PARTITION BY shopping_day ORDER BY count) AS 'Ntile'
FROM shop;
```

![05](/GB_SQL/img/05_16.png)

–í–µ—Ä–Ω–µ–º—Å—è –∫ –∑–∞–¥–∞—á–µ: –ø—Ä–æ—Å—Ç–∞–≤–∏—Ç—å —Ä–∞–Ω–≥–∏ –ø–æ —É–±—ã–≤–∞–Ω–∏—é –ó–ü (—Å–∞–º–∞—è –º–∞–ª–µ–Ω—å–∫–∞—è –ó–ü - —Å–∞–º—ã–π –º–∞–ª–µ–Ω—å–∫–∏–π —Ä–∞–Ω–≥).

–î–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ —Ä–∞–Ω–≥–∞ –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é dense_rank(). –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –ø—Ä–æ–ø—É—Å–∫ —Ä–∞–Ω–≥–∞ –Ω–µ –Ω—É–∂–µ–Ω: –Ω–∞—á–∏–Ω–∞–µ–º —Å 1 –∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–Ω–≥ –ø—Ä–∏ –æ—Ç–ª–∏—á–∏–∏ –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ. –°–ª–æ–≤–æ rank –≤—ã–¥–µ–ª—è–µ–º –≤ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏: –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–æ–ª–±—Ü–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ñ—É–Ω–∫—Ü–∏–µ–π —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è, `rank` –±—É–¥–µ—Ç —Å—á–∏—Ç–∞—Ç—å—Å—è –∫–∞–∫ –∏–º—è —Å—Ç–æ–ª–±—Ü–∞:

```sql
SELECT 
	DENSE_RANK() OVER W AS `rank`, -- W = OVER(ORDER BY salary DESC)
  first_name, discipline, 
  salary
FROM staff
WINDOW  w AS (ORDER BY salary DESC)
ORDER BY `rank`, id;
```

![05](/GB_SQL/img/05_17.png)

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ `order by` –≤ –æ–∫–Ω–µ –∑–∞–¥–∞–µ—Ç —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –æ–∫–Ω–∞, –∞ `order by` –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ ‚Äî —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ—Å–ª–µ –æ—Ç—Ä–∞–±–æ—Ç–∫–∏ –æ–∫–Ω–∞. 

–ü—É—Å—Ç—å —Ü–µ–ª—å—é –º–æ–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –±—É–¥–µ—Ç –ø—Ä–æ—Å—Ç–∞–≤–∏—Ç—å —Ä–∞–Ω–≥ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é –∑–∞—Ä–ø–ª–∞—Ç—ã, –∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ - –ø–æ —É–±—ã–≤–∞–Ω–∏—é:

```sql
SELECT 
	DENSE_RANK() OVER W AS `rank`, 
	first_name, discipline, 
  salary
FROM staff
WINDOW w AS (ORDER BY salary ASC)
ORDER BY salary DESC;
```

![05](/GB_SQL/img/05_17.png)

<hr>

[–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](#—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)

# –ê–≥—Ä–µ–≥–∏—Ä—É—é—â–∏–µ –æ–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

–°–ª–µ–¥—É—é—â–∏–π –≤–∏–¥ –æ–∫–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π - –∞–≥—Ä–µ–≥–∏—Ä—É—é—â–∏–µ. 

–û–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —É—á–µ—Ç–∞ —Å—Ä–µ–¥–Ω–µ–π –∑–∞—Ä–ø–ª–∞—Ç—ã, –ø–æ–¥—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –ó–ü –∏ —Å—É–º–º—É –ø–æ —á–µ–∫—É. –≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ —Å –Ω–∞–±–æ—Ä–æ–º –¥–∞–Ω–Ω—ã—Ö  –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç  –∏—Ç–æ–≥–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.
|||
-- | --
`sum()` | —Å—É–º–º–∞ –∑–Ω–∞—á–µ–Ω–∏–π –≤ —Å—Ç–æ–ª–±—Ü–µ;
`count()` | –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–Ω–∞—á–µ–Ω–∏–π –≤ —Å—Ç–æ–ª–±—Ü–µ (NULL –Ω–µ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è);
`avg()` | —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å—Ç–æ–ª–±—Ü–µ
`max()` | –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å—Ç–æ–ª–±—Ü–µ;
`min()` | –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å—Ç–æ–ª–±—Ü–µ.

![05](/GB_SQL/img/05_18.png)

```sql
SELECT shopping_day, department, count,
	SUM(count) OVER(PARTITION BY shopping_day) AS 'Sum' ,
	COUNT(count) OVER(PARTITION BY shopping_day) AS 'Count' ,
	AVG(count) OVER(PARTITION BY shopping_day) AS 'Avg' ,
	MAX(count) OVER(PARTITION BY shopping_day) AS 'Max' ,
	MIN(count) OVER(PARTITION BY shopping_day) AS 'Min' 
FROM shop;
```

![05](/GB_SQL/img/05_19.png)

–î–∞–≤–∞–π—Ç–µ –ø–æ–ø—Ä–æ–±—É–µ–º –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∑–Ω–∞–Ω–∏—è –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ. –ö–∞–∂–¥–∞—è –≥—Ä—É–ø–ø–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø—Ä–µ–¥–º–µ—Ç—É –ø–æ–ª—É—á–∞—é—Ç –∑–∞—Ä–ø–ª–∞—Ç—É. –î–∞–≤–∞–π—Ç–µ —É–∑–Ω–∞–µ–º, –∫–∞–∫–æ–π –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç —Å—É–º–º–∞—Ä–Ω–æ–π –ó–ü –ø–æ –æ—Ç–¥–µ–ª—É –ø–æ–ª—É—á–∞–µ—Ç –∫–∞–∂–¥—ã–π –ø–µ–¥–∞–≥–æ–≥.

![05](/GB_SQL/img/05_20.png)

```sql
SELECT
  first_name, discipline, salary,
  SUM(salary) OVER w AS payment_fund,
  ROUND(salary * 100.0 / SUM(salary) OVER w) AS percentage 
FROM staff
WINDOW  w AS (PARTITION BY discipline)
ORDER BY discipline, salary, id;
```

–ü—Ä–æ–π–¥–µ–º—Å—è –ø–æ –≤—Å–µ–π —Ç–∞–±–ª–∏—Ü–µ. –°—á–∏—Ç–∞–µ–º:
+ `payment_fund` ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—É–º–º–∞—Ä–Ω—É—é –ó–ü –æ—Ç–¥–µ–ª–∞ (–æ–Ω–∞ –æ–¥–∏–Ω–∞–∫–æ–≤–∞ –¥–ª—è –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞);
+ `percentage` ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç –∑–∞—Ä–ø–ª–∞—Ç—ã –æ—Ç —ç—Ç–æ–π —Å—É–º–º—ã.

–û–∫–Ω–æ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Å–µ–∫—Ü–∏–π –ø–æ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞–º:

```sql
WINDOW  w AS (PARTITION BY discipline)
```

–ß—Ç–æ–±—ã –Ω–∞–π—Ç–∏ —Å—É–º–º–∞—Ä–Ω—É—é –∑–∞—Ä–ø–ª–∞—Ç—É, –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∞–≥—Ä–µ–≥–∞—Ç–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `SUM(salary)` –ø–æ —Å—Ç–æ–ª–±—Ü—É `salary`. –î–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –ó–ü –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–æ—Ä–º—É–ª—É:  `salary/sum(salary)`

![05](/GB_SQL/img/05_21.png)

<hr>

[–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](#—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)

# **–§—É–Ω–∫—Ü–∏–∏ —Å–º–µ—â–µ–Ω–∏—è**

–≠—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç –ø–µ—Ä–µ–º–µ—â–∞—Ç—å—Å—è –∏ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ —Ä–∞–∑–Ω—ã–º —Å—Ç—Ä–æ–∫–∞–º –≤ –æ–∫–Ω–µ, –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–æ–∫–∏, –∞ —Ç–∞–∫–∂–µ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –≤ –Ω–∞—á–∞–ª–µ –∏–ª–∏ –≤ –∫–æ–Ω—Ü–µ –æ–∫–Ω–∞.

|||
-- | --
`lag(value)` | —Ñ—É–Ω–∫—Ü–∏—è lag()–æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –¥–∞–Ω–Ω—ã–º –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç—Ä–æ–∫–∏ –æ–∫–Ω–∞
`lead(value)` | —Ñ—É–Ω–∫—Ü–∏—è lead()–æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –¥–∞–Ω–Ω—ã–º –∏–∑ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–æ–∫–∏
`first_value()` | —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ first_value() –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –æ–∫–Ω–µ, –ø–∞—Ä–∞–º–µ—Ç—Ä - —Å—Ç–æ–ª–±–µ—Ü, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å
`last_value()` | —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ last_value() –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –æ–∫–Ω–µ, –ø–∞—Ä–∞–º–µ—Ç—Ä - —Å—Ç–æ–ª–±–µ—Ü, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å

```sql
SELECT shopping_day, department, count, 
	LAG(count) OVER(PARTITION BY shopping_day ORDER BY shopping_day) AS 'Lag' ,
	LEAD(count) OVER(PARTITION BY shopping_day ORDER BY shopping_day) AS 'Lead' ,
	FIRST_VALUE(count) OVER(PARTITION BY shopping_day ORDER BY shopping_day) AS 'First_Value' ,
	LAST_VALUE(count) OVER(PARTITION BY shopping_day ORDER BY shopping_day) AS 'Last_Value'
FROM shop;
```

![05](/GB_SQL/img/05_22.png)

<hr>

[–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](#—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)

# **–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏**

–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ ‚Äî —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ –∫–æ—Ç–æ—Ä—ã–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞. –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –º–∞—Ç–µ–º–∞—Ç–∏–∫—É –±–µ–∑ —É—Ç–æ—á–Ω–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π –±—É–¥–µ—Ç –Ω–µ –æ—á–µ–Ω—å, —É–º–µ—Å—Ç–Ω–æ:

[MySQL :: MySQL 8.0 Reference Manual :: 12.21.1 Window Function Descriptions](https://dev.mysql.com/doc/refman/8.0/en/window-function-descriptions.html?ff=nopfpls)

<hr>

[–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](#—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)

# –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (VIEW)

[MySQL :: MySQL 8.0 Reference Manual :: 25.5 Using Views](https://dev.mysql.com/doc/refman/8.0/en/views.html)

–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –ë–î —Ç—Ä–µ–±—É–µ—Ç—Å—è –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ  –∑–∞–ø—É—Å–∫–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å —Å–ª–æ–∂–Ω—ã–º–∏ –∏ —Ç—Ä–µ–±–æ–≤–∞—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º —Ç–∞–±–ª–∏—Ü–∞–º.  –ß—Ç–æ–±—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ –∑–∞–ø—Ä–æ—Å—ã, –∏–º–µ–µ—Ç —Å–º—ã—Å–ª –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞–µ–º—ã–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è–º (`view`).  

**–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ (`VIEW`)** ‚Äî –æ–±—ä–µ–∫—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, —è–≤–ª—è—é—â–∏–π—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Å –ø–æ–º–æ—â—å—é –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ `SELECT`, –≤ –º–æ–º–µ–Ω—Ç –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—é. –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏–Ω–æ–≥–¥–∞ –Ω–∞–∑—ã–≤–∞—é—Ç ¬´–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏¬ª.

![05](/GB_SQL/img/05_23.png)

**–°–∏–Ω—Ç–∞–∫—Å–∏—Å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è:**

```sql
CREATE VIEW name_view
AS
	(
		...
		query
		...
	);
```

–í —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏–º—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏ —Å–∞–º –∑–∞–ø—Ä–æ—Å –∫ –ë–î. –ü–æ–ø—Ä–æ–±—É–µ–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ. –ü–æ–ø—Ä–æ–±—É–µ–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–≤–æ–¥–∏—Ç –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ —ç—Ç–∏ –ø—Ä–µ–¥–º–µ—Ç—ã –≤–µ–¥—É—Ç:

```sql
SELECT
	discipline, count(first_name)
FROM staff
GROUP BY discipline
ORDER BY count(first_name) DESC;
```

–°–¥–µ–ª–∞–µ–º —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ–º: 

```sql
CREATE OR REPLACE VIEW count_teacher AS
SELECT
	discipline, count(first_name) AS res
FROM staff
GROUP BY discipline
ORDER BY count(first_name) DESC;
-- "OR REPLACE" –∑–∞–º–µ–Ω—è–µ—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ, –µ—Å–ª–∏ –æ–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
```
‚Äã
–¢–µ–ø–µ—Ä—å –≤–º–µ—Å—Ç–æ —É–∫–∞–∑–∞–Ω–∏—è –∫–∞–∫–æ–≥–æ - –ª–∏–±–æ —Å–ª–æ–∂–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ:

```sql
SELECT * FROM count_teacher;
```

![05](/GB_SQL/img/05_24.png)

–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω—ã –≤ –±–∞–∑–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü–µ, —Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—é, –∏—Å–ø–æ–ª—å–∑—É—é—â–µ–º—É –¥–∞–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É; –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤—ã–±–æ—Ä–∫–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –Ω–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è. –ü—Ä–∏ —ç—Ç–æ–º, –º–µ—Ö–∞–Ω–∏–∑–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ (query cache) —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–µ–∑–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫ —Ç–æ–º—É, –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫ —Ç–∞–±–ª–∏—Ü–∞–º –∏–ª–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è–º. –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –º–æ–≥—É—Ç –æ—Å–Ω–æ–≤—ã–≤–∞—Ç—å—Å—è –∫–∞–∫ –Ω–∞ —Ç–∞–±–ª–∏—Ü–∞—Ö, —Ç–∞–∫ –∏ –Ω–∞ –¥—Ä—É–≥–∏—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è—Ö, —Ç.–µ. –º–æ–≥—É—Ç –±—ã—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ (–¥–æ 32 —É—Ä–æ–≤–Ω–µ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏).

**–û–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è–º–∏**

- `DROP` :¬† –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ/–≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã `DROP VIEW`
- –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ: –º—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ–º —Å–æ–∑–¥–∞—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ, –æ–±—ä–µ–¥–∏–Ω–∏–≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü. –≠—Ç–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –±—É–¥–µ—Ç –∏–∑–≤–ª–µ–∫–∞—Ç—å —Å–æ–≤–ø–∞–¥–∞—é—â–∏–µ –∑–∞–ø–∏—Å–∏ –∏–∑ –æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü. 
- –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–æ –≤—ã—à–µ (`CREATE VIEW`)
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è -  `ALTER VIEW`

```sql
-- –ò—Å–∫–ª—é—á–∏–º –º–∞—Ç–µ–º–∞—Ç–∏–∫–æ–≤
ALTER VIEW count_teacher AS
SELECT
	discipline, count(first_name) AS res
FROM staff
WHERE discipline!="–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞"
GROUP BY discipline
ORDER BY count(first_name) DESC;
-- –ü–æ–∫–∞–∑
SELECT * FROM count_teacher;
```

![05](/GB_SQL/img/05_25.png)

<hr>

[–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](#—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)

## **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π:**

1. –î–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≥–∏–±–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º –∑–∞ —Å—á–µ—Ç —Ç–æ–≥–æ, —á—Ç–æ –ø—Ä–∞–≤–∞ –¥–∞—é—Ç—Å—è –Ω–µ –Ω–∞ —Ç–∞–±–ª–∏—Ü—É, –∞ –Ω–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ. –≠—Ç–æ –æ—á–µ–Ω—å —É–¥–æ–±–Ω–æ –≤ —Å–ª—É—á–∞–µ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω—É–∂–Ω–æ –¥–∞—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ —Ç–∞–±–ª–∏—Ü—ã –∏–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–µ —Å–∞–º–∏—Ö –¥–∞–Ω–Ω—ã—Ö, –∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∫–∞–∫–∏—Ö-—Ç–æ –¥–µ–π—Å—Ç–≤–∏–π –Ω–∞–¥ –Ω–∏–º–∏.
2. –ü–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–∑–¥–µ–ª–∏—Ç—å –ª–æ–≥–∏–∫—É —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è. –ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö, –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –∫–æ–¥, –Ω—É–∂–Ω–æ –ª–∏—à—å —Å–æ–∑–¥–∞—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è, –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü–∞–º, –∫ –∫–æ—Ç–æ—Ä—ã–º —Ä–∞–Ω—å—à–µ –æ–±—Ä–∞—â–∞–ª–∏—Å—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –≠—Ç–æ –æ—á–µ–Ω—å —É–¥–æ–±–Ω–æ –∫–æ–≥–¥–∞ –Ω–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –∫–æ–¥ –∏–ª–∏ –∫ –æ–¥–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –æ–±—Ä–∞—â–∞—é—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–∞–Ω–Ω—ã—Ö.
3. –£–¥–æ–±—Å—Ç–≤–æ –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∑–∞ —Å—á–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–∞–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π –∫–∞–∫ –¥–æ—Å—Ç—É–ø –∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —á–∞—Å—Ç–∏ —Å—Ç—Ä–æ–∫ –∏/–∏–ª–∏ —Å—Ç–æ–ª–±—Ü–æ–≤, –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü –∏ –∏—Ö –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π.

<hr>

[–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](#—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

- [https://habr.com/ru/company/oleg-bunin/blog/348172/](https://habr.com/ru/post/255361/) - DDL, DCL –Ω–∞ **MS SQL Server (1 —á–∞—Å—Ç—å).**
- https://habr.com/ru/post/255523/ - DDL, DCL –Ω–∞ **MS SQL Server (2 —á–∞—Å—Ç—å).**
- –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å—Ç–∏–ª—é –Ω–∞–ø–∏—Å–∞–Ω–∏—è SQL: https://www.sqlstyle.guide/ru/
- https://tproger.ru/translations/sql-window-functions/ - –æ–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- –°—Ç–∞—Ä–∞–π—Ç–µ—Å—å –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä—É—Å—Å–∫–∏–µ –±—É–∫–≤—ã –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –°–£–ë–î

<hr>

[–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](#—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)


+ [–î–ó](#–¥–∑)
    + [–ó–∞–¥–∞–Ω–∏–µ 1](#–∑–∞–¥–∞–Ω–∏–µ-1)
    + [–ó–∞–¥–∞–Ω–∏–µ 2](#–∑–∞–¥–∞–Ω–∏–µ-2)
    + [–ó–∞–¥–∞–Ω–∏–µ 3](#–∑–∞–¥–∞–Ω–∏–µ-3)
    + [–ó–∞–¥–∞–Ω–∏–µ 4](#–∑–∞–¥–∞–Ω–∏–µ-4)
    + [–ó–∞–¥–∞–Ω–∏–µ 5](#–∑–∞–¥–∞–Ω–∏–µ-5)


# –î–ó

## –ó–∞–¥–∞–Ω–∏–µ 1

–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ, –≤ –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–ø–∞–¥—É—Ç –∞–≤—Ç–æ–º–æ–±–∏–ª–∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å—é –¥–æ 25 000 –¥–æ–ª–ª–∞—Ä–æ–≤ CREATE VIEW CheapCars AS SELECT Name FROM Cars WHERE Cost<25000;

### –†–µ—à–µ–Ω–∏–µ

–°–æ–∑–¥–∞–¥–∏–º –∏ –∑–∞–ø–æ–ª–Ω–∏–º —Ç–∞–±–ª–∏—Ü—É

```sql
CREATE TABLE Cars
(
id INT PRIMARY KEY AUTO_INCREMENT,
name VARCHAR(25) NOT NULL,
cost INT NOT NULL
);

INSERT INTO Cars (name, cost)
VALUES
('Audi', 52642),
('Mercedes', 57127),
('Scoda', 9000),
('Volvo', 29000),
('Bentley', 350000),
('Citroen', 21000),
('Hummer', 41400),
('Volkswagen', 21600);
```

![005](/GB_SQL/Pictures/005_001.PNG)

–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ, –≤ –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–ø–∞–¥—É—Ç –∞–≤—Ç–æ–º–æ–±–∏–ª–∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å—é –¥–æ 25 000 –¥–æ–ª–ª–∞—Ä–æ–≤ 

```sql
CREATE VIEW CheapCars AS SELECT Name FROM Cars WHERE Cost<25000;
```

![005](/GB_SQL/Pictures/005_002.PNG)

[–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](#—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)

<hr>

## –ó–∞–¥–∞–Ω–∏–µ 2

–ò–∑–º–µ–Ω–∏—Ç—å –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥ –¥–ª—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏: –ø—É—Å—Ç—å —Ü–µ–Ω–∞ –±—É–¥–µ—Ç –¥–æ 30 000 –¥–æ–ª–ª–∞—Ä–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É—è –æ–ø–µ—Ä–∞—Ç–æ—Ä ALTER VIEW) 

```sql
ALTER VIEW CheapCars AS SELECT Name FROM CarsWHERE Cost<30000;
```

![005](/GB_SQL/Pictures/005_003.PNG)

[–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](#—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)

<hr>

## –ó–∞–¥–∞–Ω–∏–µ 3

–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ, –≤ –∫–æ—Ç–æ—Ä–æ–º –±—É–¥—É—Ç —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏ –º–∞—Ä–∫–∏ ‚Äú–®–∫–æ–¥–∞‚Äù –∏ ‚Äú–ê—É–¥–∏‚Äù (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ).

```sql
CREATE VIEW scoda_audi
	AS SELECT *
    FROM cars
    WHERE name = 'Scoda' OR name = 'Audi';
```

![005](/GB_SQL/Pictures/005_004.PNG)

[–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](#—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)

<hr>

## –ó–∞–¥–∞–Ω–∏–µ 4
–í—ã–≤–µ—Å—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Ü–µ–Ω—É –¥–ª—è –≤—Å–µ—Ö –∞–Ω–∞–ª–∏–∑–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–¥–∞–≤–∞–ª–∏—Å—å 5 —Ñ–µ–≤—Ä–∞–ª—è 2020 –∏ –≤—Å—é —Å–ª–µ–¥—É—é—â—É—é –Ω–µ–¥–µ–ª—é.

–ï—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞ –∞–Ω–∞–ª–∏–∑–æ–≤ Analysis: 

+ an_id ‚Äî ID –∞–Ω–∞–ª–∏–∑–∞;
+ an_name ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞;
+ an_cost ‚Äî —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –∞–Ω–∞–ª–∏–∑–∞;
+ an_price ‚Äî —Ä–æ–∑–Ω–∏—á–Ω–∞—è —Ü–µ–Ω–∞ –∞–Ω–∞–ª–∏–∑–∞;
+ an_group ‚Äî –≥—Ä—É–ø–ø–∞ –∞–Ω–∞–ª–∏–∑–æ–≤. 

–ï—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞ –≥—Ä—É–ø–ø –∞–Ω–∞–ª–∏–∑–æ–≤ Groups:
+ gr_id ‚Äî ID –≥—Ä—É–ø–ø—ã;
+ gr_name ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã;
+ gr_temp ‚Äî —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—ã–π —Ä–µ–∂–∏–º —Ö—Ä–∞–Ω–µ–Ω–∏—è. 

–ï—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤ Orders:
+ ord_id ‚Äî ID –∑–∞–∫–∞–∑–∞;
+ ord_datetime ‚Äî –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –∑–∞–∫–∞–∑–∞;
+ ord_an ‚Äî ID –∞–Ω–∞–ª–∏–∑–∞.

–°–æ–∑–¥–∞–¥–∏–º —Ç–∞–±–ª–∏—Ü—ã

```sql
CREATE TABLE Analysis
(
an_id INT,
an_name VARCHAR(40),
an_cost INT,
an_price INT,
an_group VARCHAR(40)
); 

CREATE TABLE AnalysisGroups
(
gr_id INT,
gr_name VARCHAR(25),
gr_temp INT
);

CREATE TABLE Orders
(
ord_id INT,
ord_datetime VARCHAR(25),
ord_an INT
);
```

–°–æ–µ–¥–∏–Ω–∏–º –¥–≤–µ —Ç–∞–±–ª–∏—Ü—ã Analysis, Orders –ø–æ ID –∞–Ω–∞–ª–∏–∑–∞ (an_id –∏ ord_id) –∏ –≤—ã–≤–µ–¥–µ–º –ø–æ–ª—É—á–µ–Ω–æ–µ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –æ—Ç 05.02.2020 –∏ –≤—Å—é —Å–ª–µ–¥—É—é—â—É—é –Ω–µ–¥–µ–ª—é

```sql
SELECT A.an_id, A.an_name, A.an_price, O.ord_datetime
FROM Analysis AS A
JOIN Orders AS O
ON A.an_id = O.ord_an
WHERE O.ord_datetime BETWEEN '05.02.2020' AND '12.02.2020';
```

![005](/GB_SQL/Pictures/005_005.PNG)

[–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](#—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)

<hr>

## –ó–∞–¥–∞–Ω–∏–µ 5. 
–î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü –ø–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ–º ¬´–≤—Ä–µ–º—è –¥–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç–∞–Ω—Ü–∏–∏¬ª. 

–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ, –º—ã –≤—ã—á–∏—Ç–∞–µ–º –≤—Ä–µ–º—è —Å—Ç–∞–Ω—Ü–∏–π –¥–ª—è –ø–∞—Ä —Å–º–µ–∂–Ω—ã—Ö —Å—Ç–∞–Ω—Ü–∏–π. 

–ú—ã –º–æ–∂–µ–º –≤—ã—á–∏—Å–ª–∏—Ç—å —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –æ–∫–æ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ SQL, –Ω–æ —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—á–µ–Ω—å —Å–ª–æ–∂–Ω–æ. 

–ü—Ä–æ—â–µ —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å —Å –ø–æ–º–æ—â—å—é –æ–∫–æ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ LEAD.<br>
–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ —Å–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–æ–∫–æ–π, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ —Ñ—É–Ω–∫—Ü–∏—è —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Å—Ç–æ–ª–±—Ü–µ ¬´–≤—Ä–µ–º—è¬ª –¥–ª—è —Å—Ç–∞–Ω—Ü–∏–∏ —Å–æ —Å—Ç–∞–Ω—Ü–∏–µ–π —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –Ω–µ–µ.

–°–æ–∑–¥–∞–¥–∏–º –∏ –∑–∞–ø–æ–ª–Ω–∏–º —Ç–∞–±–ª–∏—Ü—É:

```sql
CREATE TABLE timetable
(
train_id INT,
station VARCHAR(40),
station_time TIME
);

INSERT INTO timetable(train_id, station, station_time)
VALUES
(110, 'San Francisco', '10:00:00'),
(110, 'Redwood City', '10:54:00'),
(110, 'Palo Alto', '11:02:00'),
(110, 'San Jose', '12:35:00'),
(120, 'San Francisco', '11:00:00'),
(120, 'Palo Alto', '12:49:00'),
(120, 'San Jose', '13:30:00');
```
![005](/GB_SQL/Pictures/005_006.PNG)

LEAD(station_time) OVER(PARTITION BY train_id) - –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–æ–∫–µ –ø–æ –≥—Ä—É–ø–ø–∞–º

–§—É–Ω–∫—Ü–∏—è SUBTIME - –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ä–∞–∑–Ω–∏—Ü—ã –º–µ–∂–¥—É TIME –∑–Ω–∞—á–µ–Ω–∏—è–º–∏.

```sql
SELECT *,
    SUBTIME(LEAD(station_time) 
    OVER(PARTITION BY train_id), station_time) AS 'time_to_next_station'
FROM timetable;
```

![005](/GB_SQL/Pictures/005_007.PNG)

[–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](#—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)

<hr>