# Инструменты для работы с базами данных

На первой лекции будем рассматривать структуру базу данных.
Вспомним реляционные базы данных, разберем понятие “СУБД”, напишем первые запросы с помощью MySQL.

# Содержание

+ [Что мы узнаем](#что-мы-узнаем)
+ [Термины лекции](#термины-лекции)
+ [Поговорим о реляционных базах данных(БД)](#поговорим-о-реляционных-базах-данныхбд)
+ [Основные операторы SQL](#основные-операторы-sql)
    + [DDL (Data Definition Language)](#ddl-data-definition-language)
    + [DML (Data Manipulation Language)](#dml-data-manipulation-language)
    + [DCL (Data Control Language)](#dcl-data-control-language)
    + [TCL (Transaction Control Language)](#tcl-transaction-control-language)
+ [Основные компоненты СУБД](#основные-компоненты-субд)


[Содержание курса](/README.md)

# **Что мы узнаем:**

- Историю языка SQL
- Модель данных
- Узнаем про императивное и декларативное программирование
- Понятие внешнего и первичного ключа
- Основные операторы SQL
- Понятие СУБД
- Работа с UI MySQL
- Оператор SELECT

Здравствуйте, уважаемые студенты! На нашем курсе мы будем работать на языке SQL. Перед началом работы хотелось бы немного углубиться в историю.

Истоки SQL возвращают нас в 1970-е годы, когда в лабораториях IBM было создано новое программное обеспечение баз данных System R, а для управления язык - SEQUEL. Сейчас это название применяется в качестве альтернативы произношения SQL.

В 1979 году в компании Oracle (на тот момент компания называлась Relational Software), распознали коммерческий потенциал языка SQL и выпустила собственную модифицированную версию.

- **Аббревиатура SEQUEL расшифровывалась как Structured English QUEry Language — «структурированный английский язык запросов». Позже по юридическим соображениям («„sequel“ был торговой маркой британской авиастроительной группы компаний Hawker Siddeley») язык SEQUEL был переименован в SQL (Structured Query Language — «язык структурированных запросов»).**

Сегодня SQL стал стандартом языка запросов к базам данных. 

Он удовлетворяет как отраслевые, так и академические потребности и используется как на индивидуальных компьютерах, так и на корпоративных серверах. <br>
С развитием технологий баз данных приложения на основе SQL становятся все более доступными для обычного пользователя. В современной корпоративной культуре, знание SQL это одно из основных требований к аналитику. Давайте разбираться.

[Содержание](#содержание)

<hr>

# Термины лекции

__Система управления базами данных, сокр. СУБД (англ. Database Management System, сокр. DBMS)__ — совокупность программных и лингвистических средств общего или специального назначения, обеспечивающих управление созданием и использованием баз данных.

__Реляционные базы данных (от англ. Relation – связь)__ — базы данных, в которых данные распределены по отдельным, но связанным между собой таблицам.

__Кортеж (tuple)__ — это множество пар {имя аттрибута, значение}.

__Отношение (relation)__ — это множество кортежей, соответствующих одной схеме.

__Первичный ключ (Primary key)__ – поле(или набор полей) позволяющее однозначно идентифицировать запись в БД. Если ключ состоит из нескольких полей его называют составным.

__Суррогатный ключ__ — автоматически сгенерированное уникальное поле, никак не связанное с информационным содержанием записи.

__Естественный ключ__ — ключ состоящий из информационных полей таблицы.

__SQL__ — Структурированный язык запросов Декларативный язык программирования — язык программирования описывающий результат действия, не описывающий шаги для получения результата.

__Оператор (statement)__ — это наименьшая автономная часть языка программирования, команда или набор команд.

__ODBC (Open Database Connectivity)__ — программный интерфейс (API) доступа к базам данных.

[Содержание](#содержание)

<hr>

# Поговорим о реляционных базах данных(БД)

__Данные__ - информация, окружающая нас повсюду.  Для визуализации данных чаще всего используют **таблицы.** Таблицы состоят из строк и столбцов. Они являются объектами, которые содержат все данные в базах данных. 

**Базы данных (БД) —** это структурная совокупность взаимосвязанных данных определённой предметной области: реальных объектов, процессов, явлений. 

БД решает следующие задачи:

- Хранение данных
- Получение данных
- Обработка данных

Технологии БД были отнюдь не всегда. 

Изначально данные хранились в формате плоских файлов (flat files). <br>
Эти данные имели  простую структуру: данные представляли из себя записи, разделенные на поля фиксированной длины. 

В реальной жизни происходит необходимость организовывать сложные записи, которые нужно перенести в БД.  

Основным понятием в теории баз данных является **модель данных**. <br>
Она характеризует способ организации данных и методы доступа к ним. Изначально были предложены иерархическая и сетевая модель данных. 

В ходе эволюций теории была разработана реляционная модель данных. Их особенность заключается в хранении данных в формате таблицы.

![001](/GB_SQL/Pictures/001_001.png)

Таблицы, которые связаны между собой, называются реляционными. <br>
__Реляционная база данных__  — база, где данные хранятся в формате таблиц, они строго структурированы и связаны друг с другом. <br>

![001](/GB_SQL/Pictures/001_009.PNG)

Данный термин введен в 1969 году ученым из IMB, Эдгаром Коддом.  <br>
Девять лет спустя технологию стали использовать в коммерческих целях. 

Преимуществом реляционных баз данных является способность осуществлять связи между элементами, тем самым, облегчая жизнь программисту. <br>
Ранее многие задачи решались с помощью  процедурных языков программирования реализовывать операции каскадного удаления и обновления данных. 

Приведем пример: пусть информация о пользователях и заказах, которые они сделали, хранятся в двух файлах: “Пользователь”, “Заказы”. <br>
Для удаления заказа конкретного пользователя нужно организовать проход по каждому из файлов и удаление данных по конкретному условию. 

![001](/GB_SQL/Pictures/001_010.PNG)

Работа с БД во многом организована иначе: SQl является декларативным языком программирования. Для результата мы указываем, что хотим получить без указания способа получения. 

До этого мы работали с императивными языками, где для получения решения мы указывали, как получился результат. 

![001](/GB_SQL/Pictures/001_002.png)

Чтобы получить сумму 2 чисел, мы использовали 3 переменные: в первых 2 находились числа, в 3 - результат:

```csharp
int firstNumber = 1;  // первое число
int secondNumber = 2; // второе число
int result = firstNumber + secondNumber;
```

Для решения описанной выше задачи можно и применять БД. <br>
Информация хранится в двух измерениях: **строчки** и **столбцы**. 

Строчки в таблице часто именуют как “записи”, также их называют “**кортежами**”. 

Столбцы называют “**полями**” или же “**атрибутами**”. Для удобного запоминания составим небольшую табличку: 

Каждая запись разбита на несколько полей, представляющие из себя конкретный элемент. В нашем примере база данных, скорее всего, из нескольких таблиц (преподаватели, кураторы и т.д.). Понимание взаимосвязи таблиц  - ключ к понимаю основной архитектуры баз данных.

Чтобы получить представление о работе реляционных БД, необходимо понимать, как организовывается связь между ними. <br>
Реляционная БД включает в себя множество таблиц, соединенных друг с другом ключевым полем. <br>
Каждая таблица содержит в себе **первичный ключ***.* 

__Первичный ключ (Primary key)__ *–* поле(или набор полей) позволяющее однозначно идентифицировать запись в БД. <br>
Если ключ состоит из нескольких полей его называют составным. <br>
Связь происходит по **внешнему ключу**. 

__Внешний ключ (foreign key)__ - поле в  таблице, значение которого соответствует первичному ключу в другой таблице. <br>
Обратите внимание, что внешний ключ может ссылаться на существующий первичный.

Не всегда в таблице по существующим данным можно однозначно идентифицировать запись, даже используя несколько полей, также значения этих полей могут изменится (изменение первичного ключа может повлечь изменение во многих связанных таблицах). <br>
В таких случаях часто используются автоматически генерируемые атрибуты добавляемые к таблице, например числовые последовательности увеличивающиеся при каждой вставке в таблицу.

**Суррогатный** ключ - автоматически сгенерированное уникальное поле, никак не связанное с информационным содержанием записи.

**Естественный** ключ — ключ, состоящий из информационных полей таблицы.<br>
У таблицы может быть несколько ключей или не быть вообще, если ключей несколько то самый короткий из ключей выбирают в качестве первичного (это может быть как естественный так и суррогатный ключ).

![001](/GB_SQL/Pictures/001_011.PNG)

![001](/GB_SQL/Pictures/001_012.PNG)

Давайте рассмотрим эти понятия на примере задачи по созданию базы обучающихся, пример списка сведений о студентах, подумайте какие ключи тут можно выделить подумайте 1-2 минуты  и разберем варианты:

![001](/GB_SQL/Pictures/001_003.png)

Серия и номер паспорта — хорошие кандидаты для первичного ключа (потенциальный ключ), набор полей “Фамилия”, “Имя” и “год рождения” — скорее, не будет уникальным с увеличением данных. <br>
Вернемся к набору из полей “Серия” и “Номер паспорта” посмотрим на недостатки этого естественного  первичного ключа:
- может изменятся
- может отсутствовать
- возможны технические ошибки при вводе, опечатки приводящие к дубликатам
- достаточно широкий (два текстовых поля) — почему это важная характеристика? 

![001](/GB_SQL/Pictures/001_013.PNG)

![001](/GB_SQL/Pictures/001_014.PNG)

Если в базе много таблиц будут ссылаться на эту таблицу, то они должны будут использовать ключ таблицы, т. е. хранить эти поля. <br>
Пусть наша таблица “Студенты” связана с таблицей “Телефоны”.Таблица телефонов в данном случае будет выглядеть примерно так:

![001](/GB_SQL/Pictures/001_004.png)

Задача выделения первичного ключа не такая простая как могло показаться в начале, в большинстве случаев в реляционных базах используются суррогатные ключи, особенно если таблицы связаны между собой. К таблице добавляется одно числовое поле - id.

![001](/GB_SQL/Pictures/001_005.png)

Но где же можно вести БД?

Базу данных можно вести и на листе бумаги, бумажные ежедневники и блокноты также являются базами данных, на некоторых кстати нанесены по краям цветовые или буквенные метки, что по сути является индексом для упрощения поиска данных. <br>
Т.е., под базой данных понимаются непосредственно сами данные. 

Когда мы говорим про данные на жестком диске компьютера, например, то нам требуются специализированные программы для работы с ними, в русскоязычной терминологии класс таких программ получил название — система управления базами данных, сокращенно СУБД. <br>
В англоязычной терминологии DBMS - Database Management System. На сегодняшний день существует огромное множество различных СУБД от коммерческих до открытых разрабатываемых open-source сообществом, использующих разные модели хранения данных, различные технологии поиска и хранения данных. 

На сайте db-engines.com ежемесячно составляется рейтинг СУБД, сейчас в нем более 350 СУБД (https://db-engines.com/en/ranking). 

Давайте посмотрим на первые 20 из них:

![001](/GB_SQL/Pictures/001_006.png)

Август 2023 года

![001](/GB_SQL/Pictures/001_007.PNG)

Итак, мы выяснили, что существует множество реляционных СУБД, есть стандартизированный язык SQL, но вместе с тем практически в каждой СУБД реализован свой язык запросов где-то расширяющий стандарт, где-то изменяющий, какие-то конструкции стандарта могут быть не реализованы, такие вариации получили названия диалектов SQL у некоторых наиболее популярных даже есть названия:

| СУБД | Диалект |
| --- | --- |
| Oracle | PL/SQL (Procedural Language SQL) |
| MSSQL | T/SQL (Transact SQL) |
| Postgresql | PL/pgSQL ( Procedural Language PostGres SQL) |



[Содержание](#содержание)

<hr>

# **Основные операторы SQL**

***Оператор (statement)** — это наименьшая автономная часть языка программирования, команда или набор команд. (примеры из языков программирования: оператор присваивания :=, оператор IF, While, For и другие). Программа представляет собой последовательность операторов.*

В языке SQL можно выделить несколько групп операторов по типу выполняемых ими задач:

![001](/GB_SQL/Pictures/001_008.png)

## **DDL (Data Definition Language)**

Эта группа операторов для определения данных. Они необходимы, когда нужно произвести манипуляции с таблицами. Эти операторы SQL используются в тех случаях, когда нужно создать в базе новую таблицу или, напротив, удалить старую. Они включают в себя следующие командные слова:

- **CREATE** — создание нового объекта в существующей базе.
- **ALTER** — изменение существующего объекта.
- **DROP** — удаление объекта из базы.

## **DML (Data Manipulation Language)**

Эти операторы языка SQL предназначены для манипуляции данными. С помощью операторов мы можем изменять содержимое таблиц. Они помогают добавлять и удалять информацию, изменять значение строк, столбцов и прочих атрибутов. Эти операторы помогают удалить заказ, который отменили клиенты популярного маркетплейса. Это операторы:

- **SELECT** — позволяет выбрать данные в соответствии с необходимым условием.
- **INSERT** — осуществляют добавление новых данных.
- **UPDATE** — производит замену существующих данных.
- **DELETE** — удаление информации.

## **DCL (Data Control Language)**

Операторы, позволяющие предоставлять право доступа к файлам. Делают файлы либо приватными, либо открытыми. Операторы необходимы, чтобы ограничить кого-либо из сотрудников в доступе к информации или, наоборот, позволить работать с базой новому специалисту.

- **GRANT**— предоставляет доступ к объекту.
- **REVOKE**— аннулирует выданное ранее разрешение на доступ.
- **DENY**— запрет, который прекращает действие разрешения.

## **TCL (Transaction Control Language)**

Данный блок операторов предназначен для управления транзакциями. Слово “транзакция” знакомо нам из банковской сферы. На самом деле, транзакция - набор инструкции, которые выполняются как единое целое. У транзакции всего два исхода: проведена успешно, если все необходимые команды выполнены или откат, если в какой-либо инструкции произошёл сбой, то вся операция, включая предыдущие команды, отменяется. Пример - банковские платежи.

Представьте, что вы хотите заказать доставку пиццы, оплатив заказ онлайн. После ввода суммы зачастую банк высылает код подтверждения. При вводе кода мы наслаждаемся вкусной “Пепперони” , но если код не был введен, платеж отменяется автоматически

Детально о транзакциях и о требованиях к ним мы поговорим в самом конце нашего курса, на 6 лекции.

- **BEGIN TRANSACTION** — начало транзакции.
- **COMMIT TRANSACTION** — изменение команд транзакции.
- **ROLLBACK TRANSACTION** — отказ в транзакции.
- **SAVE TRANSACTION** — формирование промежуточной точки сохранения внутри операции.

[Содержание](#содержание)

<hr>

# **Основные компоненты СУБД**

Попробуем построить обобщенную архитектуру СУБД, несмотря на большое количество различных вендоров и СУБД можно выделить общие функциональные блоки:

1. Подсистема постоянного хранения данных (Storage Engine).  <br>
В большинстве случаев СУБД использует файлы и каталоги операционной системы, некоторые, например Oracle могут работать напрямую с дисками минуя слой операционной системы. Может использоваться сжатие данных.

2. Парсер и транслятор запросов (Query parser). <br>
СУБД получает от пользователя SQL запрос (это текст) его необходимо проверить на синтаксис, перевести (транслировать) во внутренний формат, определить какие объекты, таблицы например используются

3. Оптимизатор запросов (Query optimizer) <br>
Запрос не определяет четкого алгоритма действий над объектами (в каком порядке соединять таблице, какие индексы использовать и многие другие технические детали), поэтому СУБД пытается построить наиболее оптимальный план выполнения — алгоритм выполнения запроса. Дальше в СУБД будет выполняться выбранный план запроса.

4. Подсистема выполнения (Query executor). <br>
Получает готовый план и шаг за шагом выполняет инструкции.

5. Системы кэширования данных. <br>
Обращение в постоянное хранилище, к жесткому диску довольно дорогостоящий и медленный процесс, поэтому часто используемые данные СУБД пытаются кэшировать — хранить например в оперативной памяти или ssd дисках.

Большинство СУБД используют клиент-серверную архитектуру, на выделенном сервере или кластере устанавливается СУБД, с клиентских компьютеров выполняется подключение и передача запросов, вся вычислительная нагрузка выполнятся сервером. <br>
Для подключения к СУБД используются компоненты доступа — подпрограммы, иногда их называют драйверами, обычно они предоставляются разработчиком СУБД, для использования их в языках программирования разработаны модули и фреймворки которые скрывают рутинную работу от программиста.

В нашей программе мы будем использовать MySQL.

MySQL появилась в 1995 году. Она изначально была легка, доступна и интуитивно понятна. В итоге ее стали использовать компании со всего мира. В настоящее время система MySQL является негласным стандартом для баз данных.

Программа гибкая и простая в использовании. Она даже позволяет пользователям поменять исходный код, чтобы настроить сервер баз данных MySQL конкретно под себя. Доплачивать за это не придется даже в расширенных коммерческих версиях. В установке этой СУБД также нет ничего сложного — процесс займет не больше получаса.

[Содержание](#содержание)

<hr>