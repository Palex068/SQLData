## Управление данными

Учебное пособие для студентов заочного факультета

Авторы: Шакин В.Н., к.т.н, доцент.

Сосновиков Г.К., к.т.н, доцент.

Юскова И.Б., ст. преподаватель

Издание утверждено на заседании кафедры. Протокол №9 от 26.05.10

Рецензенты: В.О. Мелихов, канд. техн. наук, профессор

Т.И. Семенова, канд. техн. наук, доцент

## Содержание

+ [1. Основные понятия БД и СУБД](#1-основные-понятия-бд-и-субд)
+ [2. Системы управления баз данных и модели данных](#2-системы-управления-баз-данных-и-модели-данных)
+ [3. Основные понятия реляционной модели данных](#3-основные-понятия-реляционной-модели-данных)
+ [4. Основные понятия ER-модели](#4-основные-понятия-er-модели)
+ [5. Датологическое проектирование реляционных БД](#5-датологическое-проектирование-реляционных-бд)
+ []()

[Оглавление](/README.md)


# 1. Основные понятия БД и СУБД

Восприятие реального мира можно сопоставить с последовательностью разных, хотя иногда и взаимосвязанных, явлений. С давних времен люди пытались описать эти явления (даже тогда, когда не могли их понять). Такое описание называют **_данными_**.

А как осуществляется фиксация данных? Традиционно фиксация данных осуществляется с помощью конкретных средств общения (например, с помощью естественного языка или изображений) на конкретном носителе (например, камне или бумаге). Обычно при естественном общении **данные** (факты, явления, события, идеи или предметы) и их **интерпретация** (семантика) фиксируются совместно, так как естественный язык (язык интерпретации) достаточно гибок для представления того и другого. Примером может служить утверждение "Номер телефона Иванова И.И. – 273-16-38". Здесь "273-16-38" – данное, а " Номер телефона Иванова И.И." – его семантика.

С понятием **данные** тесно связано понятие **информации**. **Информацию** обычно определяют как изменение объема и структуры знания о некоторой предметной области (лица, предметы, факты, события, явления, процессы) воспринимающей системой (человек, организационная структура, информационная система) независимо от формы и способа представления знаний. От **информации данные** отличаются конкретной формой представления и являются некоторым ее подмножеством, которое определяется целями и задачами сбора и обработки информации. Поэтому **данные** можно определить как **информацию**, отражающую определенное состояние некоторой предметной области в конкретной форме представления и содержащую лишь наиболее существенные с точки зрения целей и задач сбора и обработки информации элементы отражаемого фрагмента действительности.

Таким образом, **информация** на стадии данных характеризуется **определенной формой** представления и дополнительной характеристикой, выражаемой термином **структура**.

**Структура данных** связана с понятием **представления информаци**и и определяется функциональной, логической, технической и т.п. структурой той предметной области, информацию о которой содержат данные. Таким образом, можно выделить **неструктурированную** (простую) и **структурированную** (сложную) **форму представления данных**. Мы будем трактовать понятия информации и данных как синонимы.

С понятие информации и интерпретацией данных тесно связано понятие **предметной области**.

**Предметной областью** называют часть реальной системы (системы реального мира), представляющая интерес для данного описания или исследования. Следовательно, предметная область позволяет описать систему реального мира с необходимым уровнем детализации.

Для облегчения обработки информации используются **информационные системы (ИС)**. Автоматизированными называются ИС, в которых применяются ЭВМ.

В широком понимании под определением ИС подпадает любая система обработки информации. Более узкая трактовка понятия ИС – это совокупность аппаратно-программных средств, задействованных для решения некоторой прикладной задачи.

Исторически, одним из первых этапов интеграции данных было объединение данных в **файлы**.

С точки зрения прикладной программы **файл** - это именованная область внешней памяти, в которую можно записывать и из которой можно извлечь данные. Правила именования файлов, способ доступа к данным, хранящимся в файле, и структура этих данных зависят от конкретной **системы управления файлами** и, возможно, от типа файла.

Отметим здесь лишь, что файловые системы обычно обеспечивают хранение слабо структурированной информации, оставляя дальнейшую структуризацию прикладным программам.

Следующим этапом интеграции данных – это **Базы Данных (БД)**. **База данных** – поименованная совокупность данных, отражающая состояние объектов (элементов предметной области) и их отношения в рассматриваемой предметной области, организованная по определенным правилам и с определенной целью, и, включающая общие принципы описания, хранения и манипулирования данными.

Уточним элементы этого определения:

+ **Совокупность, организованная по определенным правилам** означает, что указанная совокупность включает данные, которые сохраняются, имеют определенный формат (отформатированы), к ним может быть обеспечен доступ (они доступны), и они могут быть представлены потребителю информации в приемлемом виде.
+ **Совокупность, организованная с определенной целью** подчеркивает, что состав данных должен соответствовать некоторой задаче (или классу задач): т.е. с одной стороны, в базе не должны содержаться данные, не имеющие отношения к задаче, а с другой - должна содержаться вся информация, касающаяся задачи.

Прекрасным и понятным примером базы данных может служить телефонный справочник. Он содержит данные, имеющие прямое отношение к цели его существования (в данном случае - имена абонентов), которые открывают доступ к номеру телефона. В справочнике отсутствует избыточная информация, скажем цвет аппарата абонента. То есть в этой простейшей базе содержится информация, непосредственно связанная с целью ее создания.

При использовании ЭВМ для решения различных прикладных задач, можно выделить две принципиально разные области их применения:

+ **В численных расчетах** – это обычно сложные алгоритмы обработки данных, простые неструктурированные данные или слабо структурированные данные, сравнительно небольшой объем обрабатываемых данных;

+ **В информационных системах** - это обычно относительно простые алгоритмы обработки данных, имеющие сложную структуру и большой объем информации.

**БД** можно классифицировать условно по следующим признакам:
+ по области применения,
+ по используемой информации,
+ по способу использования,
+ по цели функционирования,
+ по уровням использования,
+ по использованию в сети Internet,
+ по объему хранимых данных.

**Логическую структуру данных** хранимых в базе данных называют **моделью представления данных**. 

К основным моделям данных относятся модели:
+ иерархическая,
+ сетевая,
+ реляционная,
+ постреляционная,
+ многомерная и
+ объектно-ориентированная.

Для эффективного управления **БД** и взаимодействия с пользователями (прикладными программами) между собственно физической базой данных и пользователями информационной системы в современных **ИС** располагается программное обеспечение – **Система Управления БД (СУБД)**.

**СУБД** - это комплекс языковых и программных средств, предназначенных для создания, ведения и совместного использования БД многими пользователями. Обычно СУБД различаются по использованию модели данных. Так, СУБД, основанные на использовании реляционной модели данных, называются реляционными СУБД.

**Приложение (прикладная программа)** представляет собой программу или комплекс программ, обеспечивающих автоматизацию обработки информации для прикладной задачи. Мы будем рассматривать приложения, использующие БД. Приложения могут создаваться в среде или вне среды СУБД с помощью систем программирования, использующих средства доступа к БД. Например, Delphi, С++ Builder, Visual Basic.

**Пользователей БД** можно разделить на три группы:
+ прикладные программисты,
+ конечные пользователи,
+ администраторы баз данных (АБД). 

Понятие предметной области мы определили ранее. Здесь только отметим, что для успешной реализации проекта БД, необходимо ограничить проектируемую систему определенными рамками, в которые будет, входит отдельная, четко определенная, совокупность объектов (элементов предметной области) и связей между ними.

Под термином **модель данных** будем понимать концептуальное описание предметной области. Она включает определение сущностей, связей между ними и их атрибутов. Например, сущность `Покупатель` может иметь атрибуты `Имя` и `Адрес`. Сюда входят также определяемые для сущностей ограничения: например, Имя-Покупателя не может допускать пустых значений.

Кроме того, модель данных включает в себя описание взаимоотношений между сущностями и ограничения, определенные для этих взаимоотношений. Модель данных не содержит ссылок и указаний на физическую модель самой системы.

<hr>

[Содержание](#содержание)

# 2. Системы управления баз данных и модели данных

**СУБД** должна предоставлять доступ к данным любым пользователям, включая и тех, которые практически не имеют и (или) не хотят иметь представления о следующем: физическом размещении в памяти данных и их описаний; механизмах поиска запрашиваемых данных; проблемах, возникающих при одновременном запросе одних и тех же данных многими пользователями (прикладными программами); способах обеспечения защиты данных от некорректных обновлений и (или) несанкционированного доступа; поддержки баз данных в актуальном состоянии; множестве других функций СУБД.

При выполнении основных из этих функций **СУБД** должна использовать различные описания данных.

Естественно, что проект базы данных надо начинать с анализа предметной области и выявления требований к ней отдельных пользователей (сотрудников организации, для которых создается база данных). Здесь можно отметим, что проектирование обычно поручается человеку (группе лиц) – **администратору базы данных (АБД)**. Им может быть как специально выделенный сотрудник организации, так и будущий пользователь базы данных, достаточно хорошо знакомый с машинной обработкой данных.

Объединяя частные представления о содержимом базы данных, полученные в результате опроса пользователей, и свои представления о данных, которые могут потребоваться в будущих приложениях, АБД сначала создает обобщенное неформальное описание создаваемой базы данных. Это описание, выполненное с использованием естественного языка, математических формул, таблиц, графиков и других средств, понятных всем людям, работающих над проектированием базы данных, называют инфологической моделью данных (рис.1).

![01](/Lib/Data_management/img/01_01.png)<br>
*Рис. 1. Уровни моделей данных*

Такая человеко-ориентированная модель полностью независима от физических параметров среды хранения данных. Поэтому инфологическая модель не должна изменяться до тех пор, пока какие-то изменения в реальном мире не потребуют изменения в ней некоторого определения, чтобы эта модель продолжала отражать предметную область.

Остальные модели, показанные на Рис. 1., являются компьютеро-ориентированными. С их помощью **СУБД** дает возможность программам и пользователям осуществлять доступ к хранимым данным лишь по их именам, не заботясь о физическом расположении этих данных. Нужные данные отыскиваются **СУБД** на внешних запоминающих устройствах по физической модели данных.

Так как указанный доступ осуществляется с помощью конкретной **СУБД**, то модели должны быть описаны на языке описания данных этой **СУБД**. Такое описание, создаваемое **АБД** по инфологической модели данных, называют даталогической моделью данных.

Трехуровневая архитектура:

+ инфологический,
+ даталогический и
+ физический уровни

позволяет обеспечить независимость хранимых данных от использующих их программ. **АБД** может при необходимости переписать хранимые данные на другие носители информации и (или) реорганизовать их физическую структуру, изменив лишь физическую модель данных. **АБД** может подключить к системе любое число новых пользователей (новых приложений), дополнив, если надо, даталогическую модель. Указанные изменения физической и даталогической моделей не будут замечены существующими пользователями системы (окажутся "прозрачными" для них), так же как не будут замечены и новые пользователи. Следовательно, независимость данных обеспечивает возможность развития системы баз данных без разрушения существующих приложений.

Как отмечалось ранее, инфологическая модель отображает реальный мир в некоторые понятные человеку концепции, полностью независимые от параметров среды хранения данных. Существует множество подходов к построению таких моделей:
+ графовые модели,
+ семантические сети,
+ модель "сущность-связь" и т.д. 

Наиболее популярной из них оказалась модель "сущность-связь", которая будет рассмотрена ниже.

Инфологическая модель должна быть отображена в компьютеро-ориентированную даталогическую модель, "понятную" **СУБД**. В процессе развития теории и практического использования баз данных, а также средств вычислительной техники создавались **СУБД**, поддерживающие различные даталогические модели.

Сначала стали использовать иерархические даталогические модели. Сетевые модели также создавались для мало ресурсных ЭВМ. Это достаточно сложные структуры, состоящие из "наборов" – поименованных двухуровневых деревьев. Сложность практического использования иерархических и сетевых **СУБД** заставляла искать иные способы представления данных. В конце 60-х годов появились **СУБД** на основе инвертированных файлов, отличающиеся простотой организации и наличием весьма удобных языков манипулирования данными. Сегодня наиболее распространены реляционные модели, которые будут подробно рассмотрены в главе 3.

<hr>

[Содержание](#содержание)

# 3. Основные понятия реляционной модели данных

И так, при проектировании базы данных решаются три основных проблемы:
+ Во-первых, как адекватно отразить предметную область и информационные потребности пользователей в концептуальной модели?<br>
Как мы отмечали ранее, эту проблему называют проблемой инфологического проектирования баз данных.<br>
Цель инфологического этапа проектирования состоит в получении семантических (смысловых) моделей, отражающих информационное содержание проблемы. 
+ Во-вторых, каким образом отобразить объекты предметной области в абстрактные объекты модели данных так, чтобы это отображение не противоречило семантике предметной области, и было, по возможности, наилучшим (эффективным, удобным и т.д.)?<br> 
Эта проблема известна как проблема логического проектирования баз данных.<br> 
Цель логического этапа проектирования - организация данных, выделенных на предыдущем этапе, в форму, принятую в выбранной СУБД. 
+ И в-третьих, как обеспечить эффективность выполнения запросов к базе данных, т.е. каким образом, имея в виду особенности конкретной СУБД, расположить данные во внешней памяти, создание каких дополнительных структур (например, индексов) необходимо потребовать и т.д.?<br> 
Эту проблему называют проблемой физического проектирования баз данных. Цель физического этапа - выбор рациональной структуры хранения данных и методов доступа к ним.

![01](/Lib/Data_management/img/01_02.png)<br>
*Рис. 2.*

Согласно К. Дейту, реляционная модель состоит из:
+ структурной части,
+ целостной части,
+ манипуляционной части. 

**Структурная часть** описывает, какие объекты рассматриваются реляционной моделью. Постулируется, что единственной структурой данных, используемой в реляционной модели, являются нормализованные n-арные отношения. 

**Целостная часть** описывает ограничения специального вида, которые должны выполняться для любых отношений в любых реляционных базах данных. Это целостность сущностей и целостность внешних ключей. 

**Манипуляционная часть** описывает два эквивалентных способа манипулирования реляционными данными - реляционную алгебру и реляционное исчисление.

Любые данные, используемые в программировании, имеют свои типы данных. Реляционная модель требует, чтобы типы используемых данных были простыми. В реляционной модели данных с понятием тип данных тесно связано понятие домена, которое можно считать уточнением типа данных.

**Домен** - это семантическое понятие. Как мы уже отмечали домен можно рассматривать как подмножество значений некоторого типа данных имеющих определенный смысл. 

Домен характеризуется следующими свойствами:
+ домен имеет уникальное имя (в пределах базы данных),
+ домен определен на некотором простом типе данных или на другом домене,
+ домен может иметь некоторое логическое условие, позволяющее описать подмножество данных, допустимых для данного домена,
+ домен несет определенную смысловую нагрузку. 

Например, домен D, имеющий смысл "Возраст сотрудника" можно описать как следующее подмножество множества натуральных чисел:

$D = \{n \in N: n \geq 18  \space and \space n \leq 60 \}$

Если тип данных можно считать множеством всех возможных значений данного типа, то домен напоминает подмножество в этом множестве. 

Отличие домена от понятия подмножества состоит именно в том, что домен отражает семантику, определенную предметной областью. Может быть несколько доменов, совпадающих как подмножества, но несущие различный смысл. Например, домены "Вес детали" и "Имеющееся количество" можно одинаково описать как множество неотрицательных целых чисел, но смысл этих доменов будет различным, и это будут различные домены.

Основное значение доменов состоит в том, что домены ограничивают сравнения. Некорректно, с логической точки зрения, сравнивать значения из различных доменов, даже если они имеют одинаковый тип. В этом проявляется смысловое ограничение доменов. Синтаксически правильный запрос "выдать список всех деталей, у которых вес детали больше имеющегося количества" не соответствует смыслу понятий "количество" и "вес".

Фундаментальным понятием реляционной модели данных является понятие **отношения**.

**Атрибут отношения А** есть пара вида **<Имя_атрибута: Имя_домена>**. Имена атрибутов должны быть уникальны в пределах отношения. Часто имена атрибутов отношения совпадают с именами соответствующих доменов.

**Отношение R**, определенное на множестве доменов $D_1, D_2, …,D_n$ (не обязательно различных), содержит две части: **заголовок** и **тело**.

**Заголовок отношения** содержит фиксированное количество атрибутов отношения: $(<A_1: D_1>, <A_2: D_2>,…,<A_n: D_n>)$.

**Тело отношения** содержит множество **кортежей** отношения. **Кортеж отношения** представляет собой множество пар вида:

$<Имя\_атрибута : Значение\_атрибута>: (<A_1: Val_1>, <A_2: Val_2>,…,<A_n: Val_n>)$,

таких, что значение $Val_i$ атрибута $A_i$ принадлежит домену $D_i$. 

Отношение обычно записывается в виде:
$ R(<A_1:D_1>, <A_2:D_2>,…,<A_n:D_n>)$ или короче $R(A_1, A_2,…, A_n)$ и просто $R$.

Число атрибутов в отношении называют **степенью** (или **-арностью**) отношения.

**Мощность множества кортежей** отношения называют **мощностью** отношения.

Таким образом, заголовок отношения описывает декартово произведение доменов, на котором задано отношение. Заголовок статичен, он не меняется во время работы с базой данных. Если в отношении изменены, добавлены или удалены атрибуты, то в результате получим уже другое отношение (пусть даже с прежним именем); Тело отношения представляет собой набор кортежей, т.е. подмножество декартового произведения доменов. То есть, тело отношения собственно и является отношением в математическом смысле слова. Тело отношения может изменяться во время работы с базой данных - кортежи могут изменяться, добавляться и удаляться.

**Пример 1.** Рассмотрим отношение **"Сотрудники"** заданное на доменах **"Номер_сотрудника"**, **"Фамилия"**, **"Зарплата"**, **"Номер_отдела"**. Так как все домены различны, то имена атрибутов отношения удобно назвать так же, как и соответствующие домены. Заголовок отношения имеет вид: **Сотрудники (Номер_сотрудника, Фамилия, Зарплата, Номер_отдела)**.

Пусть в данный момент отношение содержит три кортежа: **(1,Иванов, 1000, 1)**, **(2, Петров, 2000, 2),** **(3, Сидоров, 3000, 1)** . Такое отношение естественным образом представляется в виде таблицы 1:

Таблица 1. Отношение **"Сотрудники"**


Номер сотрудника | Фамилия | Зарплата | Номер_отдела
-|-|-|-
1 | Иванов | 1000 | 1
2 | Петров | 2000 | 2
3 | Сидоров | 3000 | 1

**Реляционной базой данных** называется набор отношений.

**Схемой реляционной базы данных** называется набор заголовков отношений, входящих в базу данных.

Хотя любое отношение можно изобразить в виде таблицы, нужно четко понимать, что отношения не являются таблицами. Это близкие, но не совпадающие понятия. Термины, которыми оперирует реляционная модель данных, имеют соответствующие "табличные" синонимы:

Реляционный термин  | Соответствующий "табличный" термин
-|-
База данных | Набор таблиц
Схема базы данных | Набор заголовков таблиц
Отношение | Таблица
Заголовок отношения | Заголовок таблицы
Тело отношения | Тело таблицы
Атрибут отношения | Наименование столбца таблицы
Кортеж отношения | Строка таблицы
Степень (арность) отношения | Количество столбцов таблицы
Мощность отношения | Количество строк таблицы
Домены и типы данных | Типы данных в ячейках таблицы
Первичный ключ | Один или несколько атрибутов

Рассмотрим основные свойства отношений. Свойства отношений непосредственно следуют из приведенного выше определения отношения. В этих свойствах в основном и состоят различия между отношениями и таблицами.

1. **В отношении нет одинаковых кортежей.** Действительно, тело отношения есть множество кортежей и, как всякое множество, не может содержать неразличимые элементы. Таблицы в отличие от отношений могут содержать одинаковые строки.

2. **Кортежи не упорядочены (сверху вниз).** Действительно, несмотря на то, что мы изобразили отношение "Сотрудники" в виде таблицы, нельзя сказать, что сотрудник Иванов "предшествует" сотруднику Петрову. Причина та же - тело отношения есть множество, а множество не упорядочено. Это вторая причина, по которой нельзя отождествить отношения и таблицы - строки в таблицах упорядочены. Одно и то же отношение может быть изображено разными таблицами, в которых строки идут в различном порядке.

3. **Атрибуты не упорядочены (слева направо).** Так как каждый атрибут имеет уникальное имя в пределах отношения, то порядок атрибутов не имеет значения. Это свойство несколько отличает отношение от математического определения отношения (компоненты кортежей там упорядочены). Это также третья причина, по которой нельзя отождествить отношения и таблицы - столбцы в таблице упорядочены. Одно и то же отношение может быть изображено разными таблицами, в которых столбцы идут в различном порядке.

4. **Все значения атрибутов атомарные.** Это следует из того, что лежащие в их основе атрибуты имеют атомарные значения. Это четвертое отличие отношений от таблиц - в ячейки таблиц можно поместить что угодно - массивы, структуры, и даже другие таблицы.

<hr>

[Содержание](#содержание)

## 4. Основные понятия ER-модели

Одной из наиболее популярных семантических моделей данных на этапе инфологического проектирования является неформальная модель **"Сущность-Связь"** (Entity-Relationship - **ER-модель**). Моделирование предметной области базируется на использовании графических диаграмм, включающих небольшое число разнородных компонентов. В связи с наглядностью представления концептуальных схем баз данных (и не только их) ER-модели получили широкое распространение в CASE-системах.

Основными конструктивными понятиями инфологических моделей в терминах ER-модели являются:
+ сущность,
+ экземпляр сущности,
+ связь между сущностями,
+ свойства (атрибуты) сущности,
+ домен и
+ ключ сущности.

**Сущность** – это различимый класс однотипных объектов предметной области (класс объектов, который мы можем отличить от другого класса объектов), информация о которых должна быть учтена в модели, а затем храниться в базе данных.<br>
Каждая сущность должна иметь наименование. Сущностями, например, могут быть люди, места, самолеты, рейсы, вкус, цвет, студент, накладная и т.д.

**Экземпляр сущности** – это конкретный представитель данной сущности. Например, представителем сущности «Студент» может быть «Петров И.И.». Экземпляры сущностей должны быть различимы, то есть сущности должны иметь некоторые свойства, уникальные для каждого экземпляра этой сущности. <br>
Таким образом, необходимо различать такие понятия, как класс (тип) сущности и экземпляр сущности. Понятие тип сущности относится к набору однородных личностей, предметов, событий или идей, выступающих как целое. Экземпляр сущности относится к конкретной вещи в наборе. Например, типом сущности может быть ГОРОД, а экземпляром – Москва, Киев и т.д.

**Атрибут сущности** – это именованная характеристика сущности, являющаяся (определяющая) некоторым свойством сущности и принимающая значения из некоторого множества значений. <br>
Его наименование должно быть уникальным для конкретного типа сущности, но может быть одинаковым для различного типа сущностей.<br> 
Например, ЦВЕТ может быть определен для многих сущностей: СОБАКА, АВТОМОБИЛЬ, ДЫМ и т.д.<br> 
Атрибуты используются для определения того, какая информация должна быть собрана о сущности. Примерами атрибутов для сущности АВТОМОБИЛЬ являются ТИП, МАРКА, НОМЕРНОЙ ЗНАК, ЦВЕТ и т.д.<br>
Здесь также существует различие между типом и экземпляром.<br> 
Тип атрибута ЦВЕТ имеет много экземпляров или значений: Красный, Синий, Банановый, Белая ночь и т.д., однако каждому экземпляру сущности присваивается только одно значение атрибута.

**Домен** – это диапазон допустимых значений, которые может принимать атрибут.

**Ключ сущности** – это не избыточный (минимальный) набор атрибутов, по значениям которых можно однозначно найти требуемый экземпляр сущности. Минимальность означает, что исключение из набора любого атрибута не позволяет идентифицировать сущность по оставшимся атрибутам, то есть нарушает его уникальность. Например, для сущности «СОТРУДНИК» ключом является атрибут «Табельный номер» или набор: «Фамилия», «Имя», «Отчество», «Должность». Необходимо отметить, что сущность может иметь несколько различных ключей.

**Связь** – это некоторая ассоциация между двумя сущностями, представляющая собой абстракцию набора отношений, которые систематически возникают между различными видами предметов в реальном мире. Одна сущность может быть связана с другой сущностью или сама с собой. Связи позволяют по одной сущности находить другие сущности, связанные с ней.<br>
Если бы назначением базы данных было только хранение отдельных, не связанных между собой данных, то ее структура могла бы быть очень простой. Однако одно из основных требований к организации базы данных – это обеспечение возможности отыскания одних сущностей по значениям других, для чего необходимо установить между ними определенные связи. А так как в реальных базах данных нередко содержатся сотни или даже тысячи сущностей, то теоретически между ними может быть установлено более миллиона связей. Наличие такого множества связей и определяет сложность инфологических моделей.<br>
Например, связь между сущностями может выражаться следующей фразой – «каждый студент обязан числиться ровно в одной группе».

При построении инфологических моделей в качестве инструмента моделирования будем использовать язык ER-диаграмм. В данном пособии сущности будем изображать прямоугольниками с наименованиями (Рис. 3.), атрибуты изображать в пределах прямоугольника, определяющего сущность (Рис. 4.), причем ключевые атрибуты будем подчеркивать (Рис. 5.), связи – линией, соединяющие сущности (Рис. 6.).

![01](/Lib/Data_management/img/01_03.PNG)

Каждая связь имеет два конца и одно или два наименования. Наименование обычно выражается в неопределенной глагольной форме: "иметь", "принадлежать" и т.п. Каждое из наименований относится к своему концу связи. Обычно наименования не пишутся ввиду их очевидности.

Каждая связь может иметь один из следующих типов связи:

![01](/Lib/Data_management/img/01_04.png)<br>
*Рис. 7.*

Связь типа один-к-одному (1:1) означает, что один экземпляр первой сущности (левой) связан с одним экземпляром второй сущности (правой). Связь один-к-одному чаще всего свидетельствует о том, что на самом деле мы имеем всего одну сущность, неправильно разделенную на две.

![01](/Lib/Data_management/img/01_05.png)<br>
*Рис. 8.*

На Рис. 8. связь R1 - традиционный брак: каждый муж имеет одну жену и каждая жена имеет одного мужа.

![01](/Lib/Data_management/img/01_06.png)<br>
*Рис. 9.*

Связь один ко многим (1:M) означает, что один экземпляр одной сущности (левой) связан с одним или более экземпляром другой сущности (правой) и каждый экземпляр второй сущности связан только с одним экземпляром первой сущности.

Это наиболее часто используемый тип связи. Левая сущность (со стороны "один") называется родительской, правая (со стороны "много") - дочерней. Характерный пример такой связи приведен на Рис. 10.

![01](/Lib/Data_management/img/01_07.png)<br>
*Рис. 10.*

На Рис. 10. связь R2 - владение собаками: каждый владелец может иметь одну или несколько собак, но каждая собака принадлежит только одному владельцу.

Связь типа много-ко-многим (M:N) означает, что каждый экземпляр первой сущности может быть связан с несколькими экземплярами второй сущности, и каждый экземпляр второй сущности может быть связан с несколькими экземплярами первой сущности. Тип связи много-ко-многим является временным типом связи, допустимым на ранних этапах разработки модели. В дальнейшем этот тип связи должен быть заменен двумя связями типа один-ко-многим путем создания промежуточной сущности (так называемая ассоциативная сущность).

![01](/Lib/Data_management/img/01_08.png)<br>
*Рис. 11.*

На Рис. 11. связь R3 - домовладение: каждый владелец может иметь один или несколько домов, и каждый дом является собственностью одного или несколько владельцев.

Каждая связь может иметь одну из двух модальностей связи (условная и безусловная связь) :

![01](/Lib/Data_management/img/01_09.png)<br>
*Рис. 12.*

Модальность "может" означает, что экземпляр одной сущности может быть связан с одним или несколькими экземплярами другой сущности, а может быть, и не связан ни с одним экземпляром (условная связь).

Модальность "должен" означает, что экземпляр одной сущности обязан быть связан не менее чем с одним экземпляром другой сущности (безусловная связь).

Связь может иметь разную модальность с разных концов (Рис. 7).

В условных связях, в отличие от безусловных, могут существовать экземпляры сущности, которые не принимают участия в связи.

![01](/Lib/Data_management/img/01_10.png)<br>
*Рис. 13.*

На Рис. 13. связь R4 – условная на с обоих концов, так как некоторые служащие не работают ни в одном из офисов и некоторые офисы не предназначены ни для одного из служащих.

Описанный графический синтаксис позволяет однозначно читать диаграммы, пользуясь следующей схемой построения фраз:

Каждая связь может быть прочитана как слева направо, так и справа налево. Связь на Рис. 6. читается так:

Слева направо: "каждый сотрудник может иметь несколько детей".

Справа налево: "Каждый ребенок обязан принадлежать ровно одному сотруднику".

**Пример 2.** Если связь между сущностями МУЖЧИНЫ и ЖЕНЩИНЫ называется БРАК, то существует четыре возможных представления такой связи (Рис. 14):

![01](/Lib/Data_management/img/01_11.png)<br>
*Рис. 14.*

При большом объеме, ввод лишь нескольких основных атрибутов в описание брачных связей значительно усложнит ER-диаграмму. В связи с этим язык ER-диаграмм используется для построения небольших моделей и иллюстрации отдельных фрагментов больших. Чаще же применяется менее наглядный, но более содержательный язык инфологического моделирования (ЯИМ), в котором сущности и ассоциации представляются предложениями вида:

**СУЩНОСТЬ (атр. 1, атр. 2 , ..., атр. n)**

**АССОЦИАЦИЯ[СУЩНОСТЬ S1,СУЩНОСТЬ S2,...](атр.1,атр.2,..., атр. n)**

где **S** – степень связи, а атрибуты, входящие в ключ, должны быть отмечены с помощью подчеркивания.

Для выявления связей между сущностями необходимо, как минимум, определить сами сущности. Но это не простая задача, так как в разных предметных областях один и тот же объект может быть сущностью, атрибутом или ассоциацией. Проиллюстрируем такое утверждение на примерах, связанных с описанием брачных связей.

**Пример 3.** Отдел записей актов гражданского состояния (ЗАГС) имеет дело не со всеми людьми, а только с теми, кто обратился с просьбой о регистрации брака, рождения или смерти. Поэтому в странах, где допускаются лишь традиционные браки, отделы ЗАГСа могут размещать сведения о регистрируемых браках в единственной сущности:

**Брак(Номер_свидетельства,Фамилия_мужа,Имя_мужа,Отчество_мужа, Дата_рожд_мужа, Фамилия_жены, ... ,Дата_регистр, Место_регистр, ...),**

**Пример 4.** Теперь рассмотрим ситуацию, когда отдел ЗАГСа расположен в стране, допускающей многоженство. Если для регистрации браков использовать сущность Брак предыдущего примера, то в экземплярах сущности будут дублироваться сведения о мужьях, имеющих несколько жен.

Дублирование можно исключить созданием дополнительной сущности связанной с несколько измененной сущностью:

**Мужья(Код_М,Фамилия, Имя, Отчество, Дата рождения, Место рождения)**,

**Брак(Номер_свидетельства,Код_М,Фамилияжены,...,Датарегистрации,...)**.

ER-диаграмма связи этих сущностей представлена на Рис. 15.

![01](/Lib/Data_management/img/01_12.png)<br>
*Рис. 15.*

**Пример 5.** Случай, когда какой-либо организации потребовались данные о наличии в ней семейных пар, а для хранения сведений о сотрудниках уже имеется сущность

**Сотрудники (Табельный_номер, Фамилия, Имя, ...).**

Использование рассмотренной в примере 2 сущности **Брак** нецелесообразно, так как в сущности **Сотрудники** уже есть фамилии, имена, отчества супругов. Поэтому достаточно определить связь **Брак**:

**Брак [Сотрудник 1, Сотрудник 1] (Таб_номер_мужа, таб_номер_жены, ...),**

связывающую между собой определенные экземпляры сущности Сотрудники (Рис. 16.).

![01](/Lib/Data_management/img/01_13.png)<br>
*Рис. 16.*

Таким образом, все связи требуют описания, то есть формализации. Описание должно обеспечивать: идентификацию связи; формулировку имен связи с точки зрения каждой участвующей сущности; вид связи (множественность и условность); формулировку того, как связь была формализована.

Цель формализации связей состоит в том, чтобы позволить установить связь экземпляра одной сущности с экземпляром другой. Это выполняется размещением вспомогательных атрибутов в соответствующих сущностях на модели. Когда это выполнено, говорят, что связь формализована.

Для формализации связи "один к одному" вспомогательные атрибуты могут быть добавлены к любой сущности, но не к обоим (Рис.17).

![01](/Lib/Data_management/img/01_14.png)<br>
*Рис. 17.*

Для формализации связи "один ко многим" вспомогательные атрибуты должны быть добавлены к сущности на стороне "много" (Рис. 18).

![01](/Lib/Data_management/img/01_15.png)<br>
*Рис. 18.*

Для формализации связи "многие ко многим" создают отдельную ассоциативную сущность, которая содержит ссылки на идентификаторы каждого из участвующих экземпляров (Рис. 19).

![01](/Lib/Data_management/img/01_16.png)<br>
*Рис. 19.*

Подобно любой другой, ассоциативная сущность может иметь дополнительные атрибуты и участвовать в связях с другими сущностями

Отметим здесь, что первичный ключ дочерней сущности, как правило, является внешним ключом родительской сущности, а первичный ключ ассоциативной сущности строится из первичных ключей сущностей, связи между которыми она формализует.

<hr>

[Содержание](#содержание)

## 5. Датологическое проектирование реляционных БД

Как мы уже обсуждали, процесс проектирования **БД** представляет собой последовательность переходов от неформального словесного описания информационной структуры предметной области к формализованному описанию объектов предметной области в терминах некоторой модели. В общем случае, как было отмечено ранее, можно выделить следующие этапы проектирования.

Однако этап логического проектирования не заканчивается проектированием схемы отношений, а является лишь его первым этапом, где используются способы «хорошего» или «правильного» проектирования реляционных отношений. Будем считать, что проблема логического проектирования реляционной базы данных состоит в обоснованном принятии решений о том, из каких отношений должна состоять база данных, какие атрибуты должны быть у этих отношений.

Очевидно, что для одной и той же предметной области реляционные отношения можно спроектировать множеством различных способов. Например, можно спроектировать несколько отношений с большим количеством атрибутов, или наоборот, разнести все атрибуты по большому числу мелких отношений. В общем случае проектирование схемы **БД** может быть выполнено двумя путями:
+ путем **декомпозиции** (разбиения), когда исходное множество отношений, входящих в схему **БД** заменяется другим множеством отношений (число их при этом возрастает), являющихся проекциями исходных отношений;
+ или путем **синтеза**, то есть путем компоновки из заданных исходных элементарных зависимостей между объектами предметной области схемы **БД**.

Классическая технология проектирования реляционных **БД** связана с теорией нормализации, основанной на анализе функциональных зависимостей между атрибутами отношений. Понятие функциональной зависимости является фундаментальным в теории нормализации реляционных БД и определяет устойчивые отношения между объектами и их свойствами в рассматриваемой предметной области.

Рассмотрим некоторые принципы построения хороших логических моделей данных. Хороших в том смысле, что решения, принятые в процессе логического проектирования приводили бы к хорошим физическим моделям и в конечном итоге к хорошей работе базы данных.

Для того чтобы оценить качество принимаемых решений на уровне логической модели данных, необходимо сформулировать некоторые критерии качества в терминах физической модели и конкретной реализации и посмотреть, как различные решения, принятые в процессе логического моделирования, влияют на качество физической модели и на скорость работы базы данных. Конечно, таких критериев может быть очень много и выбор их произволен. <br>
Мы рассмотрим некоторые из таких критериев, которые являются, безусловно, важными с точки зрения получения качественной базы данных:
+ адекватность базы данных предметной области;
+ легкость разработки и сопровождения базы данных;
+ скорость выполнения операций модификации данных (вставка, обновление, удаление кортежей);
+ скорость выполнения операций выборки данных.

Рассмотрим в качестве предметной области некоторую организацию, выполняющую некоторые проекты. 

Модель предметной области опишем следующим неформальным текстом:
+ Сотрудники организации выполняют проекты;
+ Проекты состоят из нескольких заданий;
+ Каждый сотрудник может участвовать в одном или нескольких проектах, или временно не участвовать ни в каких проектах;
+ Над каждым проектом может работать несколько сотрудников, или временно проект может быть приостановлен, тогда над ним не работает ни один сотрудник;
+ Над каждым заданием в проекте работает ровно один сотрудник;
+ Каждый сотрудник числится в одном отделе;
+ Каждый сотрудник имеет телефон, находящийся в отделе сотрудника.

В ходе дополнительного уточнения того, какие данные необходимо учитывать, выяснилось следующее:
+ О каждом сотруднике необходимо хранить табельный номер и фамилию.<br> 
Табельный номер является уникальным для каждого сотрудника;
+ Каждый отдел имеет уникальный номер;
+ Каждый проект имеет номер и наименование.<br> 
Номер проекта является уникальным;
+ Каждая работа из проекта имеет номер, уникальный в пределах проекта. Работы в разных проектах могут иметь одинаковые номера.

Предположим, что в ходе логического моделирования на первом шаге предложено хранить данные в одном отношении:

**СОТР_ОТД_ПР (Н_СОТР, ФАМ, Н_ОТД, ТЕЛ, Н_ПРО, ПРОЕКТ, Н_ЗАДАН),**

где:
+ **Н_СОТР** - табельный номер сотрудника;
+ **ФАМ** - фамилия сотрудника;
+ **Н_ОТД** - номер отдела, в котором числится сотрудник;
+ **ТЕЛ** - телефон сотрудника;
+ **Н_ПРО** - номер проекта, над которым работает сотрудник;
+ **ПРОЕКТ** - наименование проекта, над которым работает сотрудник;
+ **Н_ЗАДАН** - номер задания, над которым работает сотрудник.

Так как каждый сотрудник в каждом проекте выполняет ровно одно задание, то в качестве потенциального ключа отношения необходимо взять пару атрибутов **{Н_СОТР, Н_ПРО}**. А состояние предметной области отражается следующими фактами:
+ Сотрудник Иванов, работающий в 1 отделе, выполняет в первом проекте "Космос" задание 1 и во втором проекте "Климат" задание 1;
+ Сотрудник Петров, работающий в 1 отделе, выполняет в первом проекте "Космос" задание 2;
+ Сотрудник Сидоров, работающий во 2 отделе, выполняет в первом проекте "Космос" задание 3 и во втором проекте "Климат" задание 2. Это состояние отражается в таблице 5. (курсивом выделены ключевые атрибуты):

*Таблица 5. Отношение СОТР_ОТД_ПР*

Н_СОТР | ФАМ | Н_ОТД | ТЕЛ | Н_ПРО | ПРОЕКТ | Н_ЗАДАН
-- | -- | -- | -- | -- | -- | --
1 | Иванов | 1 | 11-22-33 | 1 | Космос | 1
1 | Иванов | 1 | 11-22-33 | 2 | Климат | 1
2 | Петров | 1 | 11-22-33 | 1 | Космос | 2
3 | Сидоров | 2 | 33-22-11 | 1 | Космос | 3
3 | Сидоров | 2 | 33-22-11 | 2 | Климат | 2

Даже одного взгляда на таблицу отношения **СОТР_ОТД_ПР** достаточно, чтобы увидеть, что данные хранятся в ней с большой избыточностью. Во многих строках повторяются фамилии сотрудников, номера телефонов, наименования проектов. Кроме того, в данном отношении хранятся вместе независимые друг от друга данные - и данные о сотрудниках, и об отделах, и о проектах, и о работах по проектам. Пока никаких действий с отношением не производится, это не страшно. Но как только состояние предметной области изменяется, то, при попытках соответствующим образом изменить состояние базы данных, возникает большое количество проблем.

Исторически эти проблемы получили название **аномалии**. 

Во многих работах аномалии определены как противоречие между моделью предметной области и физической моделью данных, поддерживаемых средствами конкретной СУБД. С другой точки зрения, «аномалии» это есть либо неадекватность модели данных предметной области, либо некоторые дополнительные трудности в реализации ограничений предметной области средствами СУБД.

Так как аномалии проявляют себя при выполнении операций, изменяющих состояние базы данных, то различают следующие виды аномалий:
+ Вставки;
+ Обновления;
+ Удаления.

В отношении **СОТРУ_ОТД_ПР** можно привести примеры следующих аномалий.

+ **Вставки:** В отношение **СОТРУДНИКИ_ОТДЕЛЫ_ПРОЕКТЫ** нельзя вставить данные о сотруднике, который пока не участвует ни в одном проекте. Действительно, если, например, во втором отделе появляется новый сотрудник, скажем, Пушников, и он пока не участвует ни в одном проекте, то мы должны вставить в отношение кортеж (4, Пушников, 2, 33-22-11, null, null, null). Это сделать невозможно, так как атрибут **Н_ПРО** (номер проекта) входит в состав потенциального ключа, и, следовательно, не может содержать null-значений. Точно также нельзя вставить данные о проекте, над которым пока не работает ни один сотрудник. <br>
**Причина аномалии** - хранение в одном отношении разнородной информации (и о сотрудниках, и о проектах, и о работах по проекту).<br>
**Вывод** - логическая модель данных неадекватна модели предметной области. База данных, основанная на такой модели, будет работать неправильно.

+ **Обновления:** Фамилии сотрудников, наименования проектов, номера телефонов повторяются во многих кортежах отношения. Поэтому если сотрудник меняет фамилию, или проект меняет наименование, или меняется номер телефона, то такие изменения необходимо одновременно выполнить во всех местах, где эта фамилия, наименование или номер телефона встречаются, иначе отношение станет некорректным (например, один и тот же проект в разных кортежах будет называться по-разному). Таким образом, обновление базы данных одним действием реализовать невозможно. Для поддержания отношения в целостном состоянии необходимо написать триггер, который при обновлении одной записи корректно исправлял бы данные и в других местах.<br>
**Причина аномалии** - избыточность данных, также порожденная тем, что в одном отношении хранится разнородная информация.<br>
**Вывод** - увеличивается сложность разработки базы данных. База данных, основанная на такой модели, будет работать правильно только при наличии дополнительного программного кода.

+ **Удаления:** При удалении некоторых данных может произойти потеря другой информации. Например, если закрыть проект "Космос" и удалить все строки, в которых он встречается, то будут потеряны все данные о сотруднике Петрове. Если удалить сотрудника Сидорова, то будет потеряна информация о том, что в отделе номер 2 находится телефон 33-22-11. Если по проекту временно прекращены работы, то при удалении данных о работах по этому проекту будут удалены и данные о самом проекте (наименование проекта). При этом если был сотрудник, который работал только над этим проектом, то будут потеряны и данные об этом сотруднике.<br>
**Причина аномалии** - хранение в одном отношении разнородной информации (и о сотрудниках, и о проектах, и о работах по проекту).<br>
**Вывод** - логическая модель данных неадекватна модели предметной области. База данных, основанная на такой модели, будет работать неправильно.

Отношения реляционной базы данных содержат как структурную, так и семантическую (смысловую) информацию. 

Структурная информация задается схемой отношения, а семантическая выражается функциональными связями между атрибутами схемы. 

Группировка атрибутов должна быть рациональной и удовлетворять следующим требованиям:
+ выбранные для отношения первичные ключи должны быть минимальными;
+ выбранный состав отношений должен отличаться минимальной избыточностью атрибутов;
+ между атрибутами не должно быть нежелательных функциональных зависимостей, и они должны обеспечивать минимальное дублирование данных;
+ не должно быть трудностей при выполнении операций включения, удаления и модификации (аномалии);
+ перестройка набора отношений при введении новых типов должна быть минимальной.

Пусть имеется следующее отношение: **Поставка (Название_фирмы, Адрес, Товар, Кол-во, цена)**.

Рассмотрим возможные аномалии этого отношения:

**Избыточность:** кортежи отношения многократно дублируют название и адрес фирмы, если она поставляет несколько видов товара, а тем более плохо, если имеется несколько поставок одного вида товара.

**Аномалии модификации:** вследствие избыточности при обновлении необходимо просматривать все отношение для нахождения и изменения всех подходящих строк; изменение адреса фирмы, выполненное не во всех кортежах, относящихся к некоторой конкретной фирме, ведет к нарушению целостности.

**Аномалии удаления:** удаление всех кортежей с поставками от некоторого поставщика приведет к потере адреса и других реквизитов фирмы.

**Аномалии включения:** предположим, что заключен договор, но еще нет поставок от некоторой фирмы: следует ли включать кортежи с пустым (NULL) значением количества? А не забудем ли мы впоследствии удалить строку с неопределенным значением?

Таким образом, основная цель логического проектирования базы данных - сокращение избыточности хранимых данных и устранение возможных потенциальных аномалий работы с базами данных.

Для удовлетворения вышеотмеченных требований Э.Коддом предложен аппарат нормализации отношений.

**Нормализация отношений** - это пошаговый обратимый процесс композиции или декомпозиции исходных отношений в отношения, обладающие лучшими свойствами при включении, изменении и удалении данных, назначение им ключей по определенным правилам нормализации и выявление всех возможных функциональных зависимостей.

В теории реляционных баз данных обычно выделяется следующая последовательность нормальных форм:
+ первая нормальная форма (1NF);
+ вторая нормальная форма (2NF);
+ третья нормальная форма (3NF);
+ нормальная форма Бойса-Кодда (BCNF);
+ четвертая нормальная форма (4NF);
+ пятая нормальная форма, или нормальная форма проекции-соединения (5NF или PJ/NF).

Основные свойства нормальных форм:
+ каждая следующая нормальная форма в некотором смысле является более ограниченной, но лучше, чем предыдущая;
+ при переходе к следующей нормальной форме положительные свойства предыдущих нормальных свойств сохраняются.

Нормальные формы отношений основываются на фундаментальных в теории реляционных баз данных понятиях функциональной и многозначной зависимости.

**Функциональная зависимость.** В отношении **R** атрибут **Y** функционально зависит от атрибута **X** (**X** и **Y** могут быть составными) в том и только в том случае, если каждому значению **X** соответствует в точности одно значение **Y: R.X-->R.Y**. <br>
Например:
+ Табельный номер -> Фамилия;
+ Должность -> Зарплата.

**Полная функциональная зависимость.** Функциональная зависимость **R.X -> R.Y** называется полной, если атрибут **Y** не зависит функционально от любого точного подмножества **X**.

**Неключевой атрибут.** Неключевым атрибутом называется любой атрибут отношения, не входящий в состав ключа (в частности, первичного).

**Функционально полная и частичная зависимость неключевого атрибута от составного ключа.** Неключевой атрибут функционально полно зависит от составного ключа, если он функционально зависит от ключа, но не находится в функциональной зависимости ни от какой части ключа, в противном случае имеет место частичная зависимость. Например, в отношение:

**Чтение лекций (Таб_номер, Название_курса, Кол-во_часов) Название_курса ->Кол-во_часов**

Зависимость неключевого атрибута **Кол-во_часов** от части составного ключа говорит о частичной зависимости.

**Транзитивная функциональная зависимость.** Функциональная зависимость **R.X -> R.Y** называется транзитивной, если существует такой атрибут **Z**, что имеются функциональные зависимости **R.X -> R.Z и R.Z -> R.Y** и отсутствует функциональная зависимость **R.Z ->R.X**.

**Фамилия -> Офис -> Телефон.**

**Взаимно независимые атрибуты.** Два или более атрибута взаимно независимы, если ни один из этих атрибутов не является функционально зависимым от других.

В отношении **Чтение лекций: Кол-во_часов ->->Таб_номер; Таб_номер ->-> Кол-во_часов.**

Отношение находится в 1NF тогда и только тогда, когда все входящие в него атрибуты являются атомарными (неделимыми).

Рассмотрим отношение **R1**

<hr>

[Содержание](#содержание)
